/*! For license information please see admin.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=r>>2,h=(3&r)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(e){return function(e){const i=t(e);return n.encodeByteArray(i,!0)}(e).replace(/\./g,"")},s=function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&s(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,n;return null===(n=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},c=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config},u=e=>{var t;return null===(t=o())||void 0===t?void 0:t[`_${e}`]};class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function f(){try{return"object"==typeof indexedDB}catch(e){return!1}}function p(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class g extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(y,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new g(i,o,n)}}const y=/\{\$([^}]+)}/g;function v(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(w(n)&&w(s)){if(!v(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function w(e){return null!==e&&"object"==typeof e}function I(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function b(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function E(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class T{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=_),void 0===i.error&&(i.error=_),void 0===i.complete&&(i.complete=_);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function _(){}const S=1e3,C=2,k=144e5,A=.5;function N(e,t=S,n=C){const i=t*Math.pow(n,e),r=Math.round(A*i*(Math.random()-.5)*2);return Math.min(k,i+r)}function D(e){return e&&e._delegate?e._delegate:e}class R{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new h;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:O})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=O){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=O){return this.instances.has(e)}getOptions(e=O){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===O?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=O){return this.component?this.component.multipleInstances?e:O:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const M=[];var x,F;(F=x||(x={}))[F.DEBUG=0]="DEBUG",F[F.VERBOSE=1]="VERBOSE",F[F.INFO=2]="INFO",F[F.WARN=3]="WARN",F[F.ERROR=4]="ERROR",F[F.SILENT=5]="SILENT";const U={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},V=x.INFO,j={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},B=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=j[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class q{constructor(e){this.name=e,this._logLevel=V,this._logHandler=B,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?U[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}const $=(e,t)=>t.some((t=>e instanceof t));let z,K;const H=new WeakMap,G=new WeakMap,W=new WeakMap,Q=new WeakMap,J=new WeakMap;let Y={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return G.get(e);if("objectStoreNames"===t)return e.objectStoreNames||W.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Z(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function X(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ee(this),e),Z(H.get(this))}:function(...e){return Z(t.apply(ee(this),e))}:function(e,...n){const i=t.call(ee(this),e,...n);return W.set(i,e.sort?e.sort():[e]),Z(i)}:(e instanceof IDBTransaction&&function(e){if(G.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));G.set(e,t)}(e),$(e,z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Y):e);var t}function Z(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(Z(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&H.set(t,e)})).catch((()=>{})),J.set(t,e),t}(e);if(Q.has(e))return Q.get(e);const t=X(e);return t!==e&&(Q.set(e,t),J.set(t,e)),t}const ee=e=>J.get(e),te=["get","getKey","getAll","getAllKeys","count"],ne=["put","add","delete","clear"],ie=new Map;function re(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ie.get(t))return ie.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=ne.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!te.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return ie.set(t,s),s}var se;se=Y,Y={...se,get:(e,t,n)=>re(e,t)||se.get(e,t,n),has:(e,t)=>!!re(e,t)||se.has(e,t)};class oe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ae="@firebase/app",ce="0.9.13",ue=new q("@firebase/app"),he="[DEFAULT]",le={[ae]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},de=new Map,fe=new Map;function pe(e,t){try{e.container.addComponent(t)}catch(n){ue.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ge(e){const t=e.name;if(fe.has(t))return ue.debug(`There were multiple attempts to register component ${t}.`),!1;fe.set(t,e);for(const t of de.values())pe(t,e);return!0}function me(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const ye=new m("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ve{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new R("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ye.create("app-deleted",{appName:this._name})}}const we="9.23.0";function Ie(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:he,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw ye.create("bad-app-name",{appName:String(r)});if(n||(n=c()),!n)throw ye.create("no-options");const s=de.get(r);if(s){if(v(n,s.options)&&v(i,s.config))return s;throw ye.create("duplicate-app",{appName:r})}const o=new L(r);for(const e of fe.values())o.addComponent(e);const a=new ve(n,i,o);return de.set(r,a),a}function be(e=he){const t=de.get(e);if(!t&&e===he&&c())return Ie();if(!t)throw ye.create("no-app",{appName:e});return t}function Ee(e,t,n){var i;let r=null!==(i=le[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ue.warn(e.join(" "))}ge(new R(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const Te="firebase-heartbeat-database",_e=1,Se="firebase-heartbeat-store";let Ce=null;function ke(){return Ce||(Ce=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=Z(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(Z(o.result),e.oldVersion,e.newVersion,Z(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Te,_e,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Se)}}).catch((e=>{throw ye.create("idb-open",{originalErrorMessage:e.message})}))),Ce}async function Ae(e,t){try{const n=(await ke()).transaction(Se,"readwrite"),i=n.objectStore(Se);await i.put(t,Ne(e)),await n.done}catch(e){if(e instanceof g)ue.warn(e.message);else{const t=ye.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}function Ne(e){return`${e.name}!${e.options.appId}`}class De{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Oe(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Re();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Re(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Pe(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Pe(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Re(){return(new Date).toISOString().substring(0,10)}class Oe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!f()&&p().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await ke();return await t.transaction(Se).objectStore(Se).get(Ne(e))}catch(e){if(e instanceof g)ue.warn(e.message);else{const t=ye.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ae(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Pe(e){return r(JSON.stringify({version:2,heartbeats:e})).length}ge(new R("platform-logger",(e=>new oe(e)),"PRIVATE")),ge(new R("heartbeat",(e=>new De(e)),"PRIVATE")),Ee(ae,ce,""),Ee(ae,ce,"esm2017"),Ee("fire-js","");var Le,Me="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},xe={},Fe=Fe||{},Ue=Me||self;function Ve(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function je(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Be="closure_uid_"+(1e9*Math.random()>>>0),qe=0;function $e(e,t,n){return e.call.apply(e.bind,arguments)}function ze(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Ke(e,t,n){return(Ke=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?$e:ze).apply(null,arguments)}function He(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ge(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function We(){this.s=this.s,this.o=this.o}We.prototype.s=!1,We.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Be)&&e[Be]||(e[Be]=++qe))},We.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qe=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Je(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function Ye(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Ve(n)){const t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function Xe(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Xe.prototype.h=function(){this.defaultPrevented=!0};var Ze=function(){if(!Ue.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Ue.addEventListener("test",(()=>{}),t),Ue.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function et(e){return/^[\s\xa0]*$/.test(e)}function tt(){var e=Ue.navigator;return e&&(e=e.userAgent)?e:""}function nt(e){return-1!=tt().indexOf(e)}function it(e){return it[" "](e),e}it[" "]=function(){};var rt,st,ot,at=nt("Opera"),ct=nt("Trident")||nt("MSIE"),ut=nt("Edge"),ht=ut||ct,lt=nt("Gecko")&&!(-1!=tt().toLowerCase().indexOf("webkit")&&!nt("Edge"))&&!(nt("Trident")||nt("MSIE"))&&!nt("Edge"),dt=-1!=tt().toLowerCase().indexOf("webkit")&&!nt("Edge");function ft(){var e=Ue.document;return e?e.documentMode:void 0}e:{var pt="",gt=(st=tt(),lt?/rv:([^\);]+)(\)|;)/.exec(st):ut?/Edge\/([\d\.]+)/.exec(st):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):dt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(gt&&(pt=gt?gt[1]:""),ct){var mt=ft();if(null!=mt&&mt>parseFloat(pt)){rt=String(mt);break e}}rt=pt}Ue.document&&ct?ot=ft()||parseInt(rt,10)||void 0:ot=void 0;var yt=ot;function vt(e,t){if(Xe.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(lt){e:{try{it(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:wt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&vt.$.h.call(this)}}Ge(vt,Xe);var wt={2:"touch",3:"pen",4:"mouse"};vt.prototype.h=function(){vt.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var It="closure_listenable_"+(1e6*Math.random()|0),bt=0;function Et(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.la=r,this.key=++bt,this.fa=this.ia=!1}function Tt(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function _t(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function St(e){const t={};for(const n in e)t[n]=e[n];return t}const Ct="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function kt(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<Ct.length;t++)n=Ct[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function At(e){this.src=e,this.g={},this.h=0}function Nt(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Qe(r,t);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Tt(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Dt(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==i)return r}return-1}At.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Dt(e,t,i,r);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new Et(t,this.src,s,!!i,r)).ia=n,e.push(t)),t};var Rt="closure_lm_"+(1e6*Math.random()|0),Ot={};function Pt(e,t,n,i,r){if(i&&i.once)return Mt(e,t,n,i,r);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Pt(e,t[s],n,i,r);return null}return n=qt(n),e&&e[It]?e.O(t,n,je(i)?!!i.capture:!!i,r):Lt(e,t,n,!1,i,r)}function Lt(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=je(r)?!!r.capture:!!r,a=jt(e);if(a||(e[Rt]=a=new At(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function(){const e=Vt;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)Ze||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(Ut(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Mt(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Mt(e,t[s],n,i,r);return null}return n=qt(n),e&&e[It]?e.P(t,n,je(i)?!!i.capture:!!i,r):Lt(e,t,n,!0,i,r)}function xt(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)xt(e,t[s],n,i,r);else i=je(i)?!!i.capture:!!i,n=qt(n),e&&e[It]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Dt(s=e.g[t],n,i,r))&&(Tt(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=jt(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Dt(t,n,i,r)),(n=-1<e?t[e]:null)&&Ft(n))}function Ft(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[It])Nt(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Ut(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=jt(t))?(Nt(n,e),0==n.h&&(n.src=null,t[Rt]=null)):Tt(e)}}}function Ut(e){return e in Ot?Ot[e]:Ot[e]="on"+e}function Vt(e,t){if(e.fa)e=!0;else{t=new vt(t,this);var n=e.listener,i=e.la||e.src;e.ia&&Ft(e),e=n.call(i,t)}return e}function jt(e){return(e=e[Rt])instanceof At?e:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function qt(e){return"function"==typeof e?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function $t(){We.call(this),this.i=new At(this),this.S=this,this.J=null}function zt(e,t){var n,i=e.J;if(i)for(n=[];i;i=i.J)n.push(i);if(e=e.S,i=t.type||t,"string"==typeof t)t=new Xe(t,e);else if(t instanceof Xe)t.target=t.target||e;else{var r=t;kt(t=new Xe(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=Kt(o,i,!0,t)&&r}if(r=Kt(o=t.g=e,i,!0,t)&&r,r=Kt(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=Kt(o=t.g=n[s],i,!1,t)&&r}function Kt(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&Nt(e.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Ge($t,We),$t.prototype[It]=!0,$t.prototype.removeEventListener=function(e,t,n,i){xt(this,e,t,n,i)},$t.prototype.N=function(){if($t.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)Tt(n[i]);delete t.g[e],t.h--}}this.J=null},$t.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},$t.prototype.P=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Ht=Ue.JSON.stringify;function Gt(){var e=en;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Wt=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Qt),(e=>e.reset()));class Qt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Jt(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Yt(e){Ue.setTimeout((()=>{throw e}),0)}let Xt,Zt=!1,en=new class{constructor(){this.h=this.g=null}add(e,t){const n=Wt.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},tn=()=>{const e=Ue.Promise.resolve(void 0);Xt=()=>{e.then(nn)}};var nn=()=>{for(var e;e=Gt();){try{e.h.call(e.g)}catch(e){Yt(e)}var t=Wt;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Zt=!1};function rn(e,t){$t.call(this),this.h=e||1,this.g=t||Ue,this.j=Ke(this.qb,this),this.l=Date.now()}function sn(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function on(e,t,n){if("function"==typeof e)n&&(e=Ke(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Ke(e.handleEvent,e)}return 2147483647<Number(t)?-1:Ue.setTimeout(e,t||0)}function an(e){e.g=on((()=>{e.g=null,e.i&&(e.i=!1,an(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Ge(rn,$t),(Le=rn.prototype).ga=!1,Le.T=null,Le.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),zt(this,"tick"),this.ga&&(sn(this),this.start()))}},Le.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Le.N=function(){rn.$.N.call(this),sn(this),delete this.g};class cn extends We{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:an(this)}N(){super.N(),this.g&&(Ue.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function un(e){We.call(this),this.h=e,this.g={}}Ge(un,We);var hn=[];function ln(e,t,n,i){Array.isArray(n)||(n&&(hn[0]=n.toString()),n=hn);for(var r=0;r<n.length;r++){var s=Pt(t,n[r],i||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function dn(e){_t(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ft(e)}),e),e.g={}}function fn(){this.g=!0}function pn(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return Ht(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}un.prototype.N=function(){un.$.N.call(this),dn(this)},un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},fn.prototype.Ea=function(){this.g=!1},fn.prototype.info=function(){};var gn={},mn=null;function yn(){return mn=mn||new $t}function vn(e){Xe.call(this,gn.Ta,e)}function wn(e){const t=yn();zt(t,new vn(t))}function In(e,t){Xe.call(this,gn.STAT_EVENT,e),this.stat=t}function bn(e){const t=yn();zt(t,new In(t,e))}function En(e,t){Xe.call(this,gn.Ua,e),this.size=t}function Tn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Ue.setTimeout((function(){e()}),t)}gn.Ta="serverreachability",Ge(vn,Xe),gn.STAT_EVENT="statevent",Ge(In,Xe),gn.Ua="timingevent",Ge(En,Xe);var _n={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Sn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Cn(){}function kn(e){return e.h||(e.h=e.i())}function An(){}Cn.prototype.h=null;var Nn,Dn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Rn(){Xe.call(this,"d")}function On(){Xe.call(this,"c")}function Pn(){}function Ln(e,t,n,i){this.l=e,this.j=t,this.m=n,this.W=i||1,this.U=new un(this),this.P=xn,e=ht?125:void 0,this.V=new rn(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Mn}function Mn(){this.i=null,this.g="",this.h=!1}Ge(Rn,Xe),Ge(On,Xe),Ge(Pn,Cn),Pn.prototype.g=function(){return new XMLHttpRequest},Pn.prototype.i=function(){return{}},Nn=new Pn;var xn=45e3,Fn={},Un={};function Vn(e,t,n){e.L=1,e.v=ri(Zn(t)),e.s=n,e.S=!0,jn(e,null)}function jn(e,t){e.G=Date.now(),zn(e),e.A=Zn(e.v);var n=e.A,i=e.W;Array.isArray(i)||(i=[String(i)]),yi(n.i,"t",i),e.C=0,n=e.l.J,e.h=new Mn,e.g=mr(e.l,n?t:null,!e.s),0<e.O&&(e.M=new cn(Ke(e.Pa,e,e.g),e.O)),ln(e.U,e.g,"readystatechange",e.nb),t=e.I?St(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),wn(),function(e,t,n,i,r,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function Bn(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function qn(e,t,n){let i,r=!0;for(;!e.J&&e.C<n.length;){if(i=$n(e,n),i==Un){4==t&&(e.o=4,bn(14),r=!1),pn(e.j,e.m,null,"[Incomplete Response]");break}if(i==Fn){e.o=4,bn(15),pn(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}pn(e.j,e.m,i,null),Qn(e,i)}Bn(e)&&i!=Un&&i!=Fn&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,bn(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),cr(t),t.M=!0,bn(11))):(pn(e.j,e.m,n,"[Invalid Chunked Response]"),Wn(e),Gn(e))}function $n(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Un:(n=Number(t.substring(n,i)),isNaN(n)?Fn:(i+=1)+n>t.length?Un:(t=t.slice(i,i+n),e.C=i+n,t))}function zn(e){e.Y=Date.now()+e.P,Kn(e,e.P)}function Kn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Tn(Ke(e.lb,e),t)}function Hn(e){e.B&&(Ue.clearTimeout(e.B),e.B=null)}function Gn(e){0==e.l.H||e.J||lr(e.l,e)}function Wn(e){Hn(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,sn(e.V),dn(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Qn(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Ti(n.i,e)))if(!e.K&&Ti(n.i,e)&&3==n.H){try{var i=n.Ja.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;hr(n),er(n)}ar(n),bn(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=Tn(Ke(n.ib,n),6e3));if(1>=Ei(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else fr(n,11)}else if((e.K||n.g==e)&&hr(n),!et(t))for(r=n.Ja.g.parse(t),t=0;t<r.length;t++){let u=r[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const r=u[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(_i(s,s.h),s.h=null))}if(i.F){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.Da=e,ii(i.I,i.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((i=n).wa=gr(i,i.J?i.pa:null,i.Y),o.K){Si(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(Hn(a),zn(a)),i.g=o}else or(i);0<n.j.length&&nr(n)}else"stop"!=u[0]&&"close"!=u[0]||fr(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?fr(n,7):Zi(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}wn()}catch(e){}}function Jn(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Ve(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Ve(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Ve(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}(Le=Ln.prototype).setTimeout=function(e){this.P=e},Le.nb=function(e){e=e.target;const t=this.M;t&&3==Gi(e)?t.l():this.Pa(e)},Le.Pa=function(e){try{if(e==this.g)e:{const h=Gi(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||ht||this.g&&(this.h.h||this.g.ja()||Wi(this.g)))){this.J||4!=h||7==t||wn(),Hn(this);var n=this.g.da();this.ca=n;t:if(Bn(this)){var i=Wi(this.g);e="";var r=i.length,s=4==Gi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Wn(this),Gn(this);var o="";break t}this.h.i=new Ue.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:s&&t==r-1});i.splice(0,r),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,i,r,s,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!et(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,bn(12),Wn(this),Gn(this);break e}pn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qn(this,n)}this.S?(qn(this,h,o),ht&&this.i&&3==h&&(ln(this.U,this.V,"tick",this.mb),this.V.start())):(pn(this.j,this.m,o,null),Qn(this,o)),4==h&&Wn(this),this.i&&!this.J&&(4==h?lr(this.l,this):(this.i=!1,zn(this)))}else(function(e){const t={};e=(e.g&&2<=Gi(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(et(e[i]))continue;var n=Jt(e[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[r]||[];t[r]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,bn(12)):(this.o=0,bn(13)),Wn(this),Gn(this)}}}catch(e){}},Le.mb=function(){if(this.g){var e=Gi(this.g),t=this.g.ja();this.C<t.length&&(Hn(this),qn(this,e,t),this.i&&4!=e&&zn(this))}},Le.cancel=function(){this.J=!0,Wn(this)},Le.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(wn(),bn(17)),Wn(this),this.o=2,Gn(this)):Kn(this,this.Y-e)};var Yn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xn(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Xn){this.h=e.h,ei(this,e.j),this.s=e.s,this.g=e.g,ti(this,e.m),this.l=e.l;var t=e.i,n=new fi;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ni(this,n),this.o=e.o}else e&&(t=String(e).match(Yn))?(this.h=!1,ei(this,t[1]||"",!0),this.s=si(t[2]||""),this.g=si(t[3]||"",!0),ti(this,t[4]),this.l=si(t[5]||"",!0),ni(this,t[6]||"",!0),this.o=si(t[7]||"")):(this.h=!1,this.i=new fi(null,this.h))}function Zn(e){return new Xn(e)}function ei(e,t,n){e.j=n?si(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ti(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ni(e,t,n){t instanceof fi?(e.i=t,function(e,t){t&&!e.j&&(pi(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(gi(this,t),yi(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=oi(t,li)),e.i=new fi(t,e.h))}function ii(e,t,n){e.i.set(t,n)}function ri(e){return ii(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function si(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function oi(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ai),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ai(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Xn.prototype.toString=function(){var e=[],t=this.j;t&&e.push(oi(t,ci,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(oi(t,ci,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(oi(n,"/"==n.charAt(0)?hi:ui,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",oi(n,di)),e.join("")};var ci=/[#\/\?@]/g,ui=/[#\?:]/g,hi=/[#\?]/g,li=/[#\?@]/g,di=/#/g;function fi(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pi(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function gi(e,t){pi(e),t=vi(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mi(e,t){return pi(e),t=vi(e,t),e.g.has(t)}function yi(e,t,n){gi(e,t),0<n.length&&(e.i=null,e.g.set(vi(e,t),Je(n)),e.h+=n.length)}function vi(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function wi(e){this.l=e||Ii,e=Ue.PerformanceNavigationTiming?0<(e=Ue.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Ue.g&&Ue.g.Ka&&Ue.g.Ka()&&Ue.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Le=fi.prototype).add=function(e,t){pi(this),this.i=null,e=vi(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Le.forEach=function(e,t){pi(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},Le.ta=function(){pi(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},Le.Z=function(e){pi(this);let t=[];if("string"==typeof e)mi(this,e)&&(t=t.concat(this.g.get(vi(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Le.set=function(e,t){return pi(this),this.i=null,mi(this,e=vi(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Le.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Le.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")};var Ii=10;function bi(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ei(e){return e.h?1:e.g?e.g.size:0}function Ti(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function _i(e,t){e.g?e.g.add(t):e.h=t}function Si(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ci(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Je(e.i)}wi.prototype.cancel=function(){if(this.i=Ci(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ki=class{stringify(e){return Ue.JSON.stringify(e,void 0)}parse(e){return Ue.JSON.parse(e,void 0)}};function Ai(){this.g=new ki}function Ni(e,t,n){const i=n||"";try{Jn(e,(function(e,n){let r=e;je(e)&&(r=Ht(e)),t.push(i+n+"="+encodeURIComponent(r))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function Di(e,t,n,i,r){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,r(i)}catch(e){}}function Ri(e){this.l=e.fc||null,this.j=e.ob||!1}function Oi(e,t){$t.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Pi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ge(Ri,Cn),Ri.prototype.g=function(){return new Oi(this.l,this.j)},Ri.prototype.i=function(e){return function(){return e}}({}),Ge(Oi,$t);var Pi=0;function Li(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Mi(e){e.readyState=4,e.l=null,e.j=null,e.A=null,xi(e)}function xi(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Le=Oi.prototype).open=function(e,t){if(this.readyState!=Pi)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,xi(this)},Le.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Ue).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Le.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mi(this)),this.readyState=Pi},Le.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,xi(this)),this.g&&(this.readyState=3,xi(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Ue.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Li(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Le.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Mi(this):xi(this),3==this.readyState&&Li(this)}},Le.Za=function(e){this.g&&(this.response=this.responseText=e,Mi(this))},Le.Ya=function(e){this.g&&(this.response=e,Mi(this))},Le.ka=function(){this.g&&Mi(this)},Le.setRequestHeader=function(e,t){this.v.append(e,t)},Le.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Le.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Oi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Fi=Ue.JSON.parse;function Ui(e){$t.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Vi,this.L=this.M=!1}Ge(Ui,$t);var Vi="",ji=/^https?$/i,Bi=["POST","PUT"];function qi(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,$i(e),Ki(e)}function $i(e){e.F||(e.F=!0,zt(e,"complete"),zt(e,"error"))}function zi(e){if(e.h&&void 0!==Fe&&(!e.C[1]||4!=Gi(e)||2!=e.da()))if(e.v&&4==Gi(e))on(e.La,0,e);else if(zt(e,"readystatechange"),4==Gi(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===o){var r=String(e.I).match(Yn)[1]||null;!r&&Ue.self&&Ue.self.location&&(r=Ue.self.location.protocol.slice(0,-1)),i=!ji.test(r?r.toLowerCase():"")}n=i}if(n)zt(e,"complete"),zt(e,"success");else{e.m=6;try{var s=2<Gi(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",$i(e)}}finally{Ki(e)}}}function Ki(e,t){if(e.g){Hi(e);const n=e.g,i=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||zt(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function Hi(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Ue.clearTimeout(e.A),e.A=null)}function Gi(e){return e.g?e.g.readyState:0}function Wi(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Vi:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Qi(e){let t="";return _t(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Ji(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Qi(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ii(e,t,n))}function Yi(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Xi(e){this.Ga=0,this.j=[],this.l=new fn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Yi("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Yi("baseRetryDelayMs",5e3,e),this.hb=Yi("retryDelaySeedMs",1e4,e),this.eb=Yi("forwardChannelMaxRetries",2,e),this.xa=Yi("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new wi(e&&e.concurrentRequestLimit),this.Ja=new Ai,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Zi(e){if(tr(e),3==e.H){var t=e.W++,n=Zn(e.I);if(ii(n,"SID",e.K),ii(n,"RID",t),ii(n,"TYPE","terminate"),rr(e,n),(t=new Ln(e,e.l,t)).L=2,t.v=ri(Zn(n)),n=!1,Ue.navigator&&Ue.navigator.sendBeacon)try{n=Ue.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&Ue.Image&&((new Image).src=t.v,n=!0),n||(t.g=mr(t.l,null),t.g.ha(t.v)),t.G=Date.now(),zn(t)}pr(e)}function er(e){e.g&&(cr(e),e.g.cancel(),e.g=null)}function tr(e){er(e),e.u&&(Ue.clearTimeout(e.u),e.u=null),hr(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Ue.clearTimeout(e.m),e.m=null)}function nr(e){if(!bi(e.i)&&!e.m){e.m=!0;var t=e.Na;Xt||tn(),Zt||(Xt(),Zt=!0),en.add(t,e),e.C=0}}function ir(e,t){var n;n=t?t.m:e.W++;const i=Zn(e.I);ii(i,"SID",e.K),ii(i,"RID",n),ii(i,"AID",e.V),rr(e,i),e.o&&e.s&&Ji(i,e.o,e.s),n=new Ln(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=sr(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),_i(e.i,n),Vn(n,i,t)}function rr(e,t){e.na&&_t(e.na,(function(e,n){ii(t,n,e)})),e.h&&Jn({},(function(e,n){ii(t,n,e)}))}function sr(e,t,n){n=Math.min(e.j.length,n);var i=e.h?Ke(e.h.Va,e.h,e):null;e:{var r=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=t,0>n)t=Math.max(0,r[o].g-100),s=!1;else try{Ni(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,i}function or(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Xt||tn(),Zt||(Xt(),Zt=!0),en.add(t,e),e.A=0}}function ar(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=Tn(Ke(e.Ma,e),dr(e,e.A)),e.A++,0))}function cr(e){null!=e.B&&(Ue.clearTimeout(e.B),e.B=null)}function ur(e){e.g=new Ln(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Zn(e.wa);ii(t,"RID","rpc"),ii(t,"SID",e.K),ii(t,"AID",e.V),ii(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&ii(t,"TO",e.qa),ii(t,"TYPE","xmlhttp"),rr(e,t),e.o&&e.s&&Ji(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=ri(Zn(t)),n.s=null,n.S=!0,jn(n,e)}function hr(e){null!=e.v&&(Ue.clearTimeout(e.v),e.v=null)}function lr(e,t){var n=null;if(e.g==t){hr(e),cr(e),e.g=null;var i=2}else{if(!Ti(e.i,t))return;n=t.F,Si(e.i,t),i=1}if(0!=e.H)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.G;var r=e.C;zt(i=yn(),new En(i,n)),nr(e)}else or(e);else if(3==(r=t.o)||0==r&&0<t.ca||!(1==i&&function(e,t){return!(Ei(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=Tn(Ke(e.Na,e,t),dr(e,e.C)),e.C++,0)))}(e,t)||2==i&&ar(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),r){case 1:fr(e,5);break;case 4:fr(e,10);break;case 3:fr(e,6);break;default:fr(e,2)}}function dr(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function fr(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var i=Ke(e.pb,e);n||(n=new Xn("//www.google.com/images/cleardot.gif"),Ue.location&&"http"==Ue.location.protocol||ei(n,"https"),ri(n)),function(e,t){const n=new fn;if(Ue.Image){const i=new Image;i.onload=He(Di,n,i,"TestLoadImage: loaded",!0,t),i.onerror=He(Di,n,i,"TestLoadImage: error",!1,t),i.onabort=He(Di,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=He(Di,n,i,"TestLoadImage: timeout",!1,t),Ue.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else bn(2);e.H=0,e.h&&e.h.za(t),pr(e),tr(e)}function pr(e){if(e.H=0,e.ma=[],e.h){const t=Ci(e.i);0==t.length&&0==e.j.length||(Ye(e.ma,t),Ye(e.ma,e.j),e.i.i.length=0,Je(e.j),e.j.length=0),e.h.ya()}}function gr(e,t,n){var i=n instanceof Xn?Zn(n):new Xn(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ti(i,i.m);else{var r=Ue.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new Xn(null);i&&ei(s,i),t&&(s.g=t),r&&ti(s,r),n&&(s.l=n),i=s}return n=e.F,t=e.Da,n&&t&&ii(i,n,t),ii(i,"VER",e.ra),rr(e,i),i}function mr(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Ui(new Ri({ob:!0})):new Ui(e.va)).Oa(e.J),t}function yr(){}function vr(){if(ct&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function wr(e,t){$t.call(this),this.g=new Xi(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!et(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!et(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Er(this)}function Ir(e){Rn.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function br(){On.call(this),this.status=1}function Er(e){this.g=e}function Tr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function _r(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(t^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+s&4294967295}function Sr(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}(Le=Ui.prototype).Oa=function(e){this.M=e},Le.ha=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Nn.g(),this.C=this.u?kn(this.u):kn(Nn),this.g.onreadystatechange=Ke(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void qi(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=Ue.FormData&&e instanceof Ue.FormData,!(0<=Qe(Bi,t))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Hi(this),0<this.B&&((this.L=function(e){return ct&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ke(this.ua,this)):this.A=on(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){qi(this,e)}},Le.ua=function(){void 0!==Fe&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,zt(this,"timeout"),this.abort(8))},Le.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,zt(this,"complete"),zt(this,"abort"),Ki(this))},Le.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ki(this,!0)),Ui.$.N.call(this)},Le.La=function(){this.s||(this.G||this.v||this.l?zi(this):this.kb())},Le.kb=function(){zi(this)},Le.isActive=function(){return!!this.g},Le.da=function(){try{return 2<Gi(this)?this.g.status:-1}catch(e){return-1}},Le.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Le.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Fi(t)}},Le.Ia=function(){return this.m},Le.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Le=Xi.prototype).ra=8,Le.H=1,Le.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const r=new Ln(this,this.l,e);let s=this.s;if(this.U&&(s?(s=St(s),kt(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=sr(this,r,t),ii(n=Zn(this.I),"RID",e),ii(n,"CVER",22),this.F&&ii(n,"X-HTTP-Session-Id",this.F),rr(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Qi(s)))+"&"+t:this.o&&Ji(n,this.o,s)),_i(this.i,r),this.bb&&ii(n,"TYPE","init"),this.P?(ii(n,"$req",t),ii(n,"SID","null"),r.aa=!0,Vn(r,n,null)):Vn(r,n,t),this.H=2}}else 3==this.H&&(e?ir(this,e):0==this.j.length||bi(this.i)||ir(this))},Le.Ma=function(){if(this.u=null,ur(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Tn(Ke(this.jb,this),e)}},Le.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,bn(10),er(this),ur(this))},Le.ib=function(){null!=this.v&&(this.v=null,er(this),ar(this),bn(19))},Le.pb=function(e){e?(this.l.info("Successfully pinged google.com"),bn(2)):(this.l.info("Failed to ping google.com"),bn(1))},Le.isActive=function(){return!!this.h&&this.h.isActive(this)},(Le=yr.prototype).Ba=function(){},Le.Aa=function(){},Le.za=function(){},Le.ya=function(){},Le.isActive=function(){return!0},Le.Va=function(){},vr.prototype.g=function(e,t){return new wr(e,t)},Ge(wr,$t),wr.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;bn(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=gr(e,null,e.Y),nr(e)},wr.prototype.close=function(){Zi(this.g)},wr.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Ht(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&nr(t)},wr.prototype.N=function(){this.g.h=null,delete this.j,Zi(this.g),delete this.g,wr.$.N.call(this)},Ge(Ir,Rn),Ge(br,On),Ge(Er,yr),Er.prototype.Ba=function(){zt(this.g,"a")},Er.prototype.Aa=function(e){zt(this.g,new Ir(e))},Er.prototype.za=function(e){zt(this.g,new br)},Er.prototype.ya=function(){zt(this.g,"b")},Ge(Tr,(function(){this.blockSize=-1})),Tr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Tr.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.m,r=this.h,s=0;s<t;){if(0==r)for(;s<=n;)_r(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(i[r++]=e.charCodeAt(s++),r==this.blockSize){_r(this,i),r=0;break}}else for(;s<t;)if(i[r++]=e[s++],r==this.blockSize){_r(this,i),r=0;break}}this.h=r,this.i+=t},Tr.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var Cr={};function kr(e){return-128<=e&&128>e?function(e,t){var n=Cr;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new Sr([0|e],0>e?-1:0)}(e)}(e):new Sr([0|e],0>e?-1:0)}function Ar(e){if(isNaN(e)||!isFinite(e))return Dr;if(0>e)return Mr(Ar(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=Nr;return new Sr(t,0)}var Nr=4294967296,Dr=kr(0),Rr=kr(1),Or=kr(16777216);function Pr(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Lr(e){return-1==e.h}function Mr(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new Sr(n,~e.h).add(Rr)}function xr(e,t){return e.add(Mr(t))}function Fr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ur(e,t){this.g=e,this.h=t}function Vr(e,t){if(Pr(t))throw Error("division by zero");if(Pr(e))return new Ur(Dr,Dr);if(Lr(e))return t=Vr(Mr(e),t),new Ur(Mr(t.g),Mr(t.h));if(Lr(t))return t=Vr(e,Mr(t)),new Ur(Mr(t.g),t.h);if(30<e.g.length){if(Lr(e)||Lr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Rr,i=t;0>=i.X(e);)n=jr(n),i=jr(i);var r=Br(n,1),s=Br(i,1);for(i=Br(i,2),n=Br(n,2);!Pr(i);){var o=s.add(i);0>=o.X(e)&&(r=r.add(n),s=o),i=Br(i,1),n=Br(n,1)}return t=xr(e,r.R(t)),new Ur(r,t)}for(r=Dr;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=Ar(n)).R(t);Lr(o)||0<o.X(e);)o=(s=Ar(n-=i)).R(t);Pr(s)&&(s=Rr),r=r.add(s),e=xr(e,o)}return new Ur(r,e)}function jr(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.D(i)<<1|e.D(i-1)>>>31;return new Sr(n,e.h)}function Br(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,r=[],s=0;s<i;s++)r[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new Sr(r,e.h)}(Le=Sr.prototype).ea=function(){if(Lr(this))return-Mr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.D(n);e+=(0<=i?i:Nr+i)*t,t*=Nr}return e},Le.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Pr(this))return"0";if(Lr(this))return"-"+Mr(this).toString(e);for(var t=Ar(Math.pow(e,6)),n=this,i="";;){var r=Vr(n,t).g,s=((0<(n=xr(n,r.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Pr(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},Le.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Le.X=function(e){return Lr(e=xr(this,e))?-1:Pr(e)?0:1},Le.abs=function(){return Lr(this)?Mr(this):this},Le.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,r=0;r<=t;r++){var s=i+(65535&this.D(r))+(65535&e.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(e.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new Sr(n,-2147483648&n[n.length-1]?-1:0)},Le.R=function(e){if(Pr(this)||Pr(e))return Dr;if(Lr(this))return Lr(e)?Mr(this).R(Mr(e)):Mr(Mr(this).R(e));if(Lr(e))return Mr(this.R(Mr(e)));if(0>this.X(Or)&&0>e.X(Or))return Ar(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<e.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=e.D(r)>>>16,c=65535&e.D(r);n[2*i+2*r]+=o*c,Fr(n,2*i+2*r),n[2*i+2*r+1]+=s*c,Fr(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,Fr(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,Fr(n,2*i+2*r+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new Sr(n,0)},Le.gb=function(e){return Vr(this,e).h},Le.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)&e.D(i);return new Sr(n,this.h&e.h)},Le.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)|e.D(i);return new Sr(n,this.h|e.h)},Le.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)^e.D(i);return new Sr(n,this.h^e.h)},vr.prototype.createWebChannel=vr.prototype.g,wr.prototype.send=wr.prototype.u,wr.prototype.open=wr.prototype.m,wr.prototype.close=wr.prototype.close,_n.NO_ERROR=0,_n.TIMEOUT=8,_n.HTTP_ERROR=6,Sn.COMPLETE="complete",An.EventType=Dn,Dn.OPEN="a",Dn.CLOSE="b",Dn.ERROR="c",Dn.MESSAGE="d",$t.prototype.listen=$t.prototype.O,Ui.prototype.listenOnce=Ui.prototype.P,Ui.prototype.getLastError=Ui.prototype.Sa,Ui.prototype.getLastErrorCode=Ui.prototype.Ia,Ui.prototype.getStatus=Ui.prototype.da,Ui.prototype.getResponseJson=Ui.prototype.Wa,Ui.prototype.getResponseText=Ui.prototype.ja,Ui.prototype.send=Ui.prototype.ha,Ui.prototype.setWithCredentials=Ui.prototype.Oa,Tr.prototype.digest=Tr.prototype.l,Tr.prototype.reset=Tr.prototype.reset,Tr.prototype.update=Tr.prototype.j,Sr.prototype.add=Sr.prototype.add,Sr.prototype.multiply=Sr.prototype.R,Sr.prototype.modulo=Sr.prototype.gb,Sr.prototype.compare=Sr.prototype.X,Sr.prototype.toNumber=Sr.prototype.ea,Sr.prototype.toString=Sr.prototype.toString,Sr.prototype.getBits=Sr.prototype.D,Sr.fromNumber=Ar,Sr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Mr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Ar(Math.pow(n,8)),r=Dr,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=Ar(Math.pow(n,o)),r=r.R(o).add(Ar(a))):r=(r=r.R(i)).add(Ar(a))}return r};var qr=xe.createWebChannelTransport=function(){return new vr},$r=xe.getStatEventTarget=function(){return yn()},zr=xe.ErrorCode=_n,Kr=xe.EventType=Sn,Hr=xe.Event=gn,Gr=xe.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Wr=xe.FetchXmlHttpFactory=Ri,Qr=xe.WebChannel=An,Jr=xe.XhrIo=Ui,Yr=xe.Md5=Tr,Xr=xe.Integer=Sr;const Zr="@firebase/firestore";class es{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}es.UNAUTHENTICATED=new es(null),es.GOOGLE_CREDENTIALS=new es("google-credentials-uid"),es.FIRST_PARTY=new es("first-party-uid"),es.MOCK_USER=new es("mock-user");let ts="9.23.0";const ns=new q("@firebase/firestore");function is(){return ns.logLevel}function rs(e,...t){if(ns.logLevel<=x.DEBUG){const n=t.map(as);ns.debug(`Firestore (${ts}): ${e}`,...n)}}function ss(e,...t){if(ns.logLevel<=x.ERROR){const n=t.map(as);ns.error(`Firestore (${ts}): ${e}`,...n)}}function os(e,...t){if(ns.logLevel<=x.WARN){const n=t.map(as);ns.warn(`Firestore (${ts}): ${e}`,...n)}}function as(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function cs(e="Unexpected state"){const t=`FIRESTORE (${ts}) INTERNAL ASSERTION FAILED: `+e;throw ss(t),new Error(t)}function us(e,t){e||cs()}function hs(e,t){return e}const ls={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ds extends g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class fs{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ps{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(es.UNAUTHENTICATED)))}shutdown(){}}class ms{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ys{constructor(e){this.t=e,this.currentUser=es.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new fs;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new fs,e.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{rs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(rs("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new fs)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(rs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(us("string"==typeof t.accessToken),new ps(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return us(null===e||"string"==typeof e),new es(e)}}class vs{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=es.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class ws{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new vs(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(es.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Is{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bs{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&rs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.T;return this.T=e.token,rs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{rs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?i(e):rs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(us("string"==typeof e.token),this.T=e.token,new Is(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Es(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ts{static A(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Es(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function _s(e,t){return e<t?-1:e>t?1:0}function Ss(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}class Cs{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ds(ls.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ds(ls.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ds(ls.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ds(ls.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Cs.fromMillis(Date.now())}static fromDate(e){return Cs.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Cs(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?_s(this.nanoseconds,e.nanoseconds):_s(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ks{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ks(e)}static min(){return new ks(new Cs(0,0))}static max(){return new ks(new Cs(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class As{constructor(e,t,n){void 0===t?t=0:t>e.length&&cs(),void 0===n?n=e.length-t:n>e.length-t&&cs(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===As.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof As?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),r=t.get(i);if(n<r)return-1;if(n>r)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ns extends As{construct(e,t,n){return new Ns(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ds(ls.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ns(t)}static emptyPath(){return new Ns([])}}const Ds=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rs extends As{construct(e,t,n){return new Rs(e,t,n)}static isValidIdentifier(e){return Ds.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rs.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Rs(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new ds(ls.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new ds(ls.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ds(ls.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new ds(ls.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rs(t)}static emptyPath(){return new Rs([])}}class Os{constructor(e){this.path=e}static fromPath(e){return new Os(Ns.fromString(e))}static fromName(e){return new Os(Ns.fromString(e).popFirst(5))}static empty(){return new Os(Ns.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ns.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ns.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Os(new Ns(e.slice()))}}function Ps(e){return new Ls(e.readTime,e.key,-1)}class Ls{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ls(ks.min(),Os.empty(),-1)}static max(){return new Ls(ks.max(),Os.empty(),-1)}}function Ms(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Os.comparator(e.documentKey,t.documentKey),0!==n?n:_s(e.largestBatchId,t.largestBatchId))}const xs="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Us(e){if(e.code!==ls.FAILED_PRECONDITION||e.message!==xs)throw e;rs("LocalStore","Unexpectedly lost primary lease")}class Vs{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&cs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Vs(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Vs?t:Vs.resolve(t)}catch(e){return Vs.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Vs.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Vs.reject(t)}static resolve(e){return new Vs(((t,n)=>{t(e)}))}static reject(e){return new Vs(((t,n)=>{n(e)}))}static waitFor(e){return new Vs(((t,n)=>{let i=0,r=0,s=!1;e.forEach((e=>{++i,e.next((()=>{++r,s&&r===i&&t()}),(e=>n(e)))})),s=!0,r===i&&t()}))}static or(e){let t=Vs.resolve(!1);for(const n of e)t=t.next((e=>e?Vs.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new Vs(((n,i)=>{const r=e.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===r&&n(s)}),(e=>i(e)))}}))}static doWhile(e,t){return new Vs(((n,i)=>{const r=()=>{!0===e()?t().next((()=>{r()}),i):n()};r()}))}}function js(e){return"IndexedDbTransactionError"===e.name}class Bs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function qs(e){return null==e}function $s(e){return 0===e&&1/e==-1/0}Bs.ct=-1;function zs(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Ks(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Hs(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Gs{constructor(e,t){this.comparator=e,this.root=t||Qs.EMPTY}insert(e,t){return new Gs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qs.BLACK,null,null))}remove(e){return new Gs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ws(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ws(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ws(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ws(this.root,e,this.comparator,!0)}}class Ws{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qs{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Qs.RED,this.left=null!=i?i:Qs.EMPTY,this.right=null!=r?r:Qs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new Qs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Qs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Qs.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw cs();if(this.right.isRed())throw cs();const e=this.left.check();if(e!==this.right.check())throw cs();return e+(this.isRed()?0:1)}}Qs.EMPTY=null,Qs.RED=!0,Qs.BLACK=!1,Qs.EMPTY=new class{constructor(){this.size=0}get key(){throw cs()}get value(){throw cs()}get color(){throw cs()}get left(){throw cs()}get right(){throw cs()}copy(e,t,n,i,r){return this}insert(e,t,n){return new Qs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Js{constructor(e){this.comparator=e,this.data=new Gs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ys(this.data.getIterator())}getIteratorFrom(e){return new Ys(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Js))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Js(this.comparator);return t.data=e,t}}class Ys{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Xs{constructor(e){this.fields=e,e.sort(Rs.comparator)}static empty(){return new Xs([])}unionWith(e){let t=new Js(Rs.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Xs(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ss(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Zs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class eo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Zs("Invalid base64 string: "+e):e}}(e);return new eo(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new eo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return _s(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}eo.EMPTY_BYTE_STRING=new eo("");const to=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function no(e){if(us(!!e),"string"==typeof e){let t=0;const n=to.exec(e);if(us(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:io(e.seconds),nanos:io(e.nanos)}}function io(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ro(e){return"string"==typeof e?eo.fromBase64String(e):eo.fromUint8Array(e)}function so(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function oo(e){const t=e.mapValue.fields.__previous_value__;return so(t)?oo(t):t}function ao(e){const t=no(e.mapValue.fields.__local_write_time__.timestampValue);return new Cs(t.seconds,t.nanos)}class co{constructor(e,t,n,i,r,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class uo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new uo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof uo&&e.projectId===this.projectId&&e.database===this.database}}const ho={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function lo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?so(e)?4:Co(e)?9007199254740991:10:cs()}function fo(e,t){if(e===t)return!0;const n=lo(e);if(n!==lo(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ao(e).isEqual(ao(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=no(e.timestampValue),i=no(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ro(e.bytesValue).isEqual(ro(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return io(e.geoPointValue.latitude)===io(t.geoPointValue.latitude)&&io(e.geoPointValue.longitude)===io(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return io(e.integerValue)===io(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=io(e.doubleValue),i=io(t.doubleValue);return n===i?$s(n)===$s(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Ss(e.arrayValue.values||[],t.arrayValue.values||[],fo);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(zs(n)!==zs(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!fo(n[e],i[e])))return!1;return!0}(e,t);default:return cs()}}function po(e,t){return void 0!==(e.values||[]).find((e=>fo(e,t)))}function go(e,t){if(e===t)return 0;const n=lo(e),i=lo(t);if(n!==i)return _s(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return _s(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=io(e.integerValue||e.doubleValue),i=io(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return mo(e.timestampValue,t.timestampValue);case 4:return mo(ao(e),ao(t));case 5:return _s(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ro(e),i=ro(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=_s(n[e],i[e]);if(0!==t)return t}return _s(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=_s(io(e.latitude),io(t.latitude));return 0!==n?n:_s(io(e.longitude),io(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=go(n[e],i[e]);if(t)return t}return _s(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===ho.mapValue&&t===ho.mapValue)return 0;if(e===ho.mapValue)return 1;if(t===ho.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){const t=_s(i[e],s[e]);if(0!==t)return t;const o=go(n[i[e]],r[s[e]]);if(0!==o)return o}return _s(i.length,s.length)}(e.mapValue,t.mapValue);default:throw cs()}}function mo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return _s(e,t);const n=no(e),i=no(t),r=_s(n.seconds,i.seconds);return 0!==r?r:_s(n.nanos,i.nanos)}function yo(e){return vo(e)}function vo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=no(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ro(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Os.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=vo(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${vo(e.fields[r])}`;return n+"}"}(e.mapValue):cs();var t,n}function wo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Io(e){return!!e&&"integerValue"in e}function bo(e){return!!e&&"arrayValue"in e}function Eo(e){return!!e&&"nullValue"in e}function To(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function _o(e){return!!e&&"mapValue"in e}function So(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Ks(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=So(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=So(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Co(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class ko{constructor(e){this.value=e}static empty(){return new ko({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!_o(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=So(t)}setAll(e){let t=Rs.emptyPath(),n={},i=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=So(e):i.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());_o(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return fo(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];_o(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Ks(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new ko(So(this.value))}}class Ao{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Ao(e,0,ks.min(),ks.min(),ks.min(),ko.empty(),0)}static newFoundDocument(e,t,n,i){return new Ao(e,1,t,ks.min(),n,i,0)}static newNoDocument(e,t){return new Ao(e,2,t,ks.min(),ks.min(),ko.empty(),0)}static newUnknownDocument(e,t){return new Ao(e,3,t,ks.min(),ks.min(),ko.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ks.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ko.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ko.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ks.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ao&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ao(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class No{constructor(e,t){this.position=e,this.inclusive=t}}function Do(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?Os.comparator(Os.fromName(o.referenceValue),n.key):go(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Ro(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!fo(e.position[n],t.position[n]))return!1;return!0}class Oo{constructor(e,t="asc"){this.field=e,this.dir=t}}function Po(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Lo{}class Mo extends Lo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new qo(e,t,n):"array-contains"===t?new Ho(e,n):"in"===t?new Go(e,n):"not-in"===t?new Wo(e,n):"array-contains-any"===t?new Qo(e,n):new Mo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new $o(e,n):new zo(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(go(t,this.value)):null!==t&&lo(this.value)===lo(t)&&this.matchesComparison(go(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return cs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class xo extends Lo{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new xo(e,t)}matches(e){return Fo(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft((e=>e.isInequality()));return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Fo(e){return"and"===e.op}function Uo(e){return function(e){for(const t of e.filters)if(t instanceof xo)return!1;return!0}(e)&&Fo(e)}function Vo(e){if(e instanceof Mo)return e.field.canonicalString()+e.op.toString()+yo(e.value);if(Uo(e))return e.filters.map((e=>Vo(e))).join(",");{const t=e.filters.map((e=>Vo(e))).join(",");return`${e.op}(${t})`}}function jo(e,t){return e instanceof Mo?function(e,t){return t instanceof Mo&&e.op===t.op&&e.field.isEqual(t.field)&&fo(e.value,t.value)}(e,t):e instanceof xo?function(e,t){return t instanceof xo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,i)=>e&&jo(n,t.filters[i])),!0)}(e,t):void cs()}function Bo(e){return e instanceof Mo?function(e){return`${e.field.canonicalString()} ${e.op} ${yo(e.value)}`}(e):e instanceof xo?function(e){return e.op.toString()+" {"+e.getFilters().map(Bo).join(" ,")+"}"}(e):"Filter"}class qo extends Mo{constructor(e,t,n){super(e,t,n),this.key=Os.fromName(n.referenceValue)}matches(e){const t=Os.comparator(e.key,this.key);return this.matchesComparison(t)}}class $o extends Mo{constructor(e,t){super(e,"in",t),this.keys=Ko(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class zo extends Mo{constructor(e,t){super(e,"not-in",t),this.keys=Ko(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ko(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Os.fromName(e.referenceValue)))}class Ho extends Mo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bo(t)&&po(t.arrayValue,this.value)}}class Go extends Mo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&po(this.value.arrayValue,t)}}class Wo extends Mo{constructor(e,t){super(e,"not-in",t)}matches(e){if(po(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!po(this.value.arrayValue,t)}}class Qo extends Mo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>po(this.value.arrayValue,e)))}}class Jo{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.dt=null}}function Yo(e,t=null,n=[],i=[],r=null,s=null,o=null){return new Jo(e,t,n,i,r,s,o)}function Xo(e){const t=hs(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Vo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),qs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>yo(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>yo(e))).join(",")),t.dt=e}return t.dt}function Zo(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Po(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!jo(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ro(e.startAt,t.startAt)&&Ro(e.endAt,t.endAt)}function ea(e){return Os.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ta{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function na(e){return new ta(e)}function ia(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ra(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function sa(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function oa(e){return null!==e.collectionGroup}function aa(e){const t=hs(e);if(null===t.wt){t.wt=[];const e=sa(t),n=ra(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Oo(e)),t.wt.push(new Oo(Rs.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Oo(Rs.keyField(),e))}}}return t.wt}function ca(e){const t=hs(e);if(!t._t)if("F"===t.limitType)t._t=Yo(t.path,t.collectionGroup,aa(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of aa(t)){const t="desc"===n.dir?"asc":"desc";e.push(new Oo(n.field,t))}const n=t.endAt?new No(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new No(t.startAt.position,t.startAt.inclusive):null;t._t=Yo(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t._t}function ua(e,t){t.getFirstInequalityField(),sa(e);const n=e.filters.concat([t]);return new ta(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function ha(e,t,n){return new ta(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function la(e,t){return Zo(ca(e),ca(t))&&e.limitType===t.limitType}function da(e){return`${Xo(ca(e))}|lt:${e.limitType}`}function fa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Bo(e))).join(", ")}]`),qs(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>yo(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>yo(e))).join(",")),`Target(${t})`}(ca(e))}; limitType=${e.limitType})`}function pa(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Os.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of aa(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Do(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,aa(e),t)||e.endAt&&!function(e,t,n){const i=Do(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,aa(e),t))}(e,t)}function ga(e){return(t,n)=>{let i=!1;for(const r of aa(e)){const e=ma(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function ma(e,t,n){const i=e.field.isKeyField()?Os.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?go(i,r):cs()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return cs()}}class ya{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ks(this.inner,((t,n)=>{for(const[t,i]of n)e(t,i)}))}isEmpty(){return Hs(this.inner)}size(){return this.innerSize}}const va=new Gs(Os.comparator);function wa(){return va}const Ia=new Gs(Os.comparator);function ba(...e){let t=Ia;for(const n of e)t=t.insert(n.key,n);return t}function Ea(e){let t=Ia;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Ta(){return Sa()}function _a(){return Sa()}function Sa(){return new ya((e=>e.toString()),((e,t)=>e.isEqual(t)))}new Gs(Os.comparator);const Ca=new Js(Os.comparator);function ka(...e){let t=Ca;for(const n of e)t=t.add(n);return t}const Aa=new Js(_s);function Na(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$s(t)?"-0":t}}function Da(e){return{integerValue:""+e}}function Ra(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!$s(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Da(t):Na(e,t)}class Oa{constructor(){this._=void 0}}function Pa(e,t,n){return e instanceof Ma?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&so(t)&&(t=oo(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof xa?Fa(e,t):e instanceof Ua?Va(e,t):function(e,t){const n=function(e,t){return e instanceof ja?Io(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}(e,t),i=Ba(n)+Ba(e.gt);return Io(n)&&Io(e.gt)?Da(i):Na(e.serializer,i)}(e,t)}function La(e,t,n){return e instanceof xa?Fa(e,t):e instanceof Ua?Va(e,t):n}class Ma extends Oa{}class xa extends Oa{constructor(e){super(),this.elements=e}}function Fa(e,t){const n=qa(t);for(const t of e.elements)n.some((e=>fo(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Ua extends Oa{constructor(e){super(),this.elements=e}}function Va(e,t){let n=qa(t);for(const t of e.elements)n=n.filter((e=>!fo(e,t)));return{arrayValue:{values:n}}}class ja extends Oa{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Ba(e){return io(e.integerValue||e.doubleValue)}function qa(e){return bo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class $a{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new $a}static exists(e){return new $a(void 0,e)}static updateTime(e){return new $a(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function za(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ka{}function Ha(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new tc(e.key,$a.none()):new Ja(e.key,e.data,$a.none());{const n=e.data,i=ko.empty();let r=new Js(Rs.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new Ya(e.key,i,new Xs(r.toArray()),$a.none())}}function Ga(e,t,n){e instanceof Ja?function(e,t,n){const i=e.value.clone(),r=Za(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof Ya?function(e,t,n){if(!za(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Za(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Xa(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Wa(e,t,n,i){return e instanceof Ja?function(e,t,n,i){if(!za(e.precondition,t))return n;const r=e.value.clone(),s=ec(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof Ya?function(e,t,n,i){if(!za(e.precondition,t))return n;const r=ec(e.fieldTransforms,i,t),s=t.data;return s.setAll(Xa(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):function(e,t,n){return za(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Qa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ss(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof xa&&t instanceof xa||e instanceof Ua&&t instanceof Ua?Ss(e.elements,t.elements,fo):e instanceof ja&&t instanceof ja?fo(e.gt,t.gt):e instanceof Ma&&t instanceof Ma}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ja extends Ka{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ya extends Ka{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Xa(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function Za(e,t,n){const i=new Map;us(e.length===n.length);for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,La(o,a,n[r]))}return i}function ec(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,Pa(e,s,t))}return i}class tc extends Ka{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nc{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&Ga(i,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Wa(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Wa(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=_a();return this.mutations.forEach((i=>{const r=e.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=t.has(i.key)?null:o;const a=Ha(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(ks.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ka())}isEqual(e){return this.batchId===e.batchId&&Ss(this.mutations,e.mutations,((e,t)=>Qa(e,t)))&&Ss(this.baseMutations,e.baseMutations,((e,t)=>Qa(e,t)))}}class ic{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class rc{constructor(e,t){this.count=e,this.unchangedNames=t}}var sc,oc;function ac(e){if(void 0===e)return ss("GRPC error has no .code"),ls.UNKNOWN;switch(e){case sc.OK:return ls.OK;case sc.CANCELLED:return ls.CANCELLED;case sc.UNKNOWN:return ls.UNKNOWN;case sc.DEADLINE_EXCEEDED:return ls.DEADLINE_EXCEEDED;case sc.RESOURCE_EXHAUSTED:return ls.RESOURCE_EXHAUSTED;case sc.INTERNAL:return ls.INTERNAL;case sc.UNAVAILABLE:return ls.UNAVAILABLE;case sc.UNAUTHENTICATED:return ls.UNAUTHENTICATED;case sc.INVALID_ARGUMENT:return ls.INVALID_ARGUMENT;case sc.NOT_FOUND:return ls.NOT_FOUND;case sc.ALREADY_EXISTS:return ls.ALREADY_EXISTS;case sc.PERMISSION_DENIED:return ls.PERMISSION_DENIED;case sc.FAILED_PRECONDITION:return ls.FAILED_PRECONDITION;case sc.ABORTED:return ls.ABORTED;case sc.OUT_OF_RANGE:return ls.OUT_OF_RANGE;case sc.UNIMPLEMENTED:return ls.UNIMPLEMENTED;case sc.DATA_LOSS:return ls.DATA_LOSS;default:return cs()}}(oc=sc||(sc={}))[oc.OK=0]="OK",oc[oc.CANCELLED=1]="CANCELLED",oc[oc.UNKNOWN=2]="UNKNOWN",oc[oc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",oc[oc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",oc[oc.NOT_FOUND=5]="NOT_FOUND",oc[oc.ALREADY_EXISTS=6]="ALREADY_EXISTS",oc[oc.PERMISSION_DENIED=7]="PERMISSION_DENIED",oc[oc.UNAUTHENTICATED=16]="UNAUTHENTICATED",oc[oc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",oc[oc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",oc[oc.ABORTED=10]="ABORTED",oc[oc.OUT_OF_RANGE=11]="OUT_OF_RANGE",oc[oc.UNIMPLEMENTED=12]="UNIMPLEMENTED",oc[oc.INTERNAL=13]="INTERNAL",oc[oc.UNAVAILABLE=14]="UNAVAILABLE",oc[oc.DATA_LOSS=15]="DATA_LOSS";class cc{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return uc}static getOrCreateInstance(){return null===uc&&(uc=new cc),uc}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach((t=>t(e)))}}let uc=null;const hc=new Xr([4294967295,4294967295],0);function lc(e){const t=(new TextEncoder).encode(e),n=new Yr;return n.update(t),new Uint8Array(n.digest())}function dc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Xr([n,i],0),new Xr([r,s],0)]}class fc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new pc(`Invalid padding: ${t}`);if(n<0)throw new pc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new pc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new pc(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Xr.fromNumber(this.It)}Et(e,t,n){let i=e.add(t.multiply(Xr.fromNumber(n)));return 1===i.compare(hc)&&(i=new Xr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=lc(e),[n,i]=dc(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,i,e);if(!this.At(t))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),s=new fc(r,i,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.It)return;const t=lc(e),[n,i]=dc(t);for(let e=0;e<this.hashCount;e++){const t=this.Et(n,i,e);this.Rt(t)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class pc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class gc{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,mc.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new gc(ks.min(),i,new Gs(_s),wa(),ka())}}class mc{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new mc(n,t,ka(),ka(),ka())}}class yc{constructor(e,t,n,i){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=i}}class vc{constructor(e,t){this.targetId=e,this.Vt=t}}class wc{constructor(e,t,n=eo.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Ic{constructor(){this.St=0,this.Dt=Tc(),this.Ct=eo.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=ka(),t=ka(),n=ka();return this.Dt.forEach(((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:cs()}})),new mc(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=Tc()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class bc{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=wa(),this.zt=Ec(),this.Wt=new Gs(_s)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,(t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:cs()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach(((e,n)=>{this.te(n)&&t(n)}))}ne(e){var t;const n=e.targetId,i=e.Vt.count,r=this.se(n);if(r){const s=r.target;if(ea(s))if(0===i){const e=new Os(s.path);this.Yt(n,e,Ao.newNoDocument(e,ks.min()))}else us(1===i);else{const r=this.ie(n);if(r!==i){const i=this.re(e,r);if(0!==i){this.ee(n);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=cc.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var i,r,s,o,a,c;const u={localCacheCount:t,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(u.bloomFilter={applied:0===e,hashCount:null!==(i=null==h?void 0:h.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(s=null===(r=null==h?void 0:h.bits)||void 0===r?void 0:r.bitmap)||void 0===s?void 0:s.length)&&void 0!==o?o:0,padding:null!==(c=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.padding)&&void 0!==c?c:0}),u}(i,r,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:i}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=ro(r).toUint8Array()}catch(e){if(e instanceof Zs)return os("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{c=new fc(a,s,o)}catch(e){return os(e instanceof pc?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===c.It?1:i!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let i=0;return n.forEach((n=>{const r=this.Gt.ue(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),i++)})),i}ce(e){const t=new Map;this.Qt.forEach(((n,i)=>{const r=this.se(i);if(r){if(n.current&&ea(r.target)){const t=new Os(r.target.path);null!==this.jt.get(t)||this.ae(i,t)||this.Yt(i,t,Ao.newNoDocument(t,e))}n.Mt&&(t.set(i,n.Ot()),n.Ft())}}));let n=ka();this.zt.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.jt.forEach(((t,n)=>n.setReadTime(e)));const i=new gc(e,t,this.Wt,this.jt,n);return this.jt=wa(),this.zt=Ec(),this.Wt=new Gs(_s),i}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new Ic,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new Js(_s),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||rs("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new Ic),this.Gt.getRemoteKeysForTarget(e).forEach((t=>{this.Yt(e,t,null)}))}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function Ec(){return new Gs(Os.comparator)}function Tc(){return new Gs(Os.comparator)}const _c={asc:"ASCENDING",desc:"DESCENDING"},Sc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cc={and:"AND",or:"OR"};class kc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ac(e,t){return e.useProto3Json||qs(t)?t:{value:t}}function Nc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Dc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Rc(e){return us(!!e),ks.fromTimestamp(function(e){const t=no(e);return new Cs(t.seconds,t.nanos)}(e))}function Oc(e,t){return function(e){return new Ns(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Pc(e){const t=Ns.fromString(e);return us(Wc(t)),t}function Lc(e,t){const n=Pc(t);if(n.get(1)!==e.databaseId.projectId)throw new ds(ls.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ds(ls.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Os(Fc(n))}function Mc(e,t){return Oc(e.databaseId,t)}function xc(e){return new Ns(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Fc(e){return us(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Uc(e,t){return{documents:[Mc(e,t.path)]}}function Vc(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=Mc(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Mc(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(e){if(0!==e.length)return Gc(xo.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Kc(e.field),direction:qc(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Ac(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function jc(e){let t=function(e){const t=Pc(e);return 4===t.length?Ns.emptyPath():Fc(t)}(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){us(1===i);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Bc(e);return t instanceof xo&&Uo(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Oo(Hc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,qs(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new No(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new No(n,t)}(n.endAt)),function(e,t,n,i,r,s,o,a){return new ta(e,t,n,i,r,s,o,a)}(t,r,o,s,a,"F",c,u)}function Bc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Hc(e.unaryFilter.field);return Mo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Hc(e.unaryFilter.field);return Mo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Hc(e.unaryFilter.field);return Mo.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Hc(e.unaryFilter.field);return Mo.create(r,"!=",{nullValue:"NULL_VALUE"});default:return cs()}}(e):void 0!==e.fieldFilter?function(e){return Mo.create(Hc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return cs()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return xo.create(e.compositeFilter.filters.map((e=>Bc(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return cs()}}(e.compositeFilter.op))}(e):cs()}function qc(e){return _c[e]}function $c(e){return Sc[e]}function zc(e){return Cc[e]}function Kc(e){return{fieldPath:e.canonicalString()}}function Hc(e){return Rs.fromServerFormat(e.fieldPath)}function Gc(e){return e instanceof Mo?function(e){if("=="===e.op){if(To(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NAN"}};if(Eo(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(To(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NAN"}};if(Eo(e.value))return{unaryFilter:{field:Kc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Kc(e.field),op:$c(e.op),value:e.value}}}(e):e instanceof xo?function(e){const t=e.getFilters().map((e=>Gc(e)));return 1===t.length?t[0]:{compositeFilter:{op:zc(e.op),filters:t}}}(e):cs()}function Wc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Qc{constructor(e,t,n,i,r=ks.min(),s=ks.min(),o=eo.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Qc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Qc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Qc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Qc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Jc{constructor(e){this.fe=e}}function Yc(e){const t=jc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ha(t,t.limit,"L"):t}class Xc{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(io(e.integerValue));else if("doubleValue"in e){const n=io(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),$s(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(ro(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?Co(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):cs()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const e of Object.keys(n))this.Te(e,t),this.me(n[e],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const e of n)this.me(e,t)}ve(e,t){this.ye(t,37),Os.fromName(e).path.forEach((e=>{this.ye(t,60),this.be(e,t)}))}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}Xc.Ve=new Xc;class Zc{constructor(){this.rn=new eu}addToCollectionParentIndex(e,t){return this.rn.add(t),Vs.resolve()}getCollectionParents(e,t){return Vs.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return Vs.resolve()}deleteFieldIndex(e,t){return Vs.resolve()}getDocumentsMatchingTarget(e,t){return Vs.resolve(null)}getIndexType(e,t){return Vs.resolve(0)}getFieldIndexes(e,t){return Vs.resolve([])}getNextCollectionGroupToUpdate(e){return Vs.resolve(null)}getMinOffset(e,t){return Vs.resolve(Ls.min())}getMinOffsetFromCollectionGroup(e,t){return Vs.resolve(Ls.min())}updateCollectionGroup(e,t,n){return Vs.resolve()}updateIndexEntries(e,t){return Vs.resolve()}}class eu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Js(Ns.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Js(Ns.comparator)).toArray()}}new Uint8Array(0);class tu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new tu(e,tu.DEFAULT_COLLECTION_PERCENTILE,tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}tu.DEFAULT_COLLECTION_PERCENTILE=10,tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tu.DEFAULT=new tu(41943040,tu.DEFAULT_COLLECTION_PERCENTILE,tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tu.DISABLED=new tu(-1,0,0);class nu{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new nu(0)}static Mn(){return new nu(-1)}}class iu{constructor(){this.changes=new ya((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ao.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Vs.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ru{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class su{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Wa(n.mutation,e,Xs.empty(),Cs.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,ka()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=ka()){const i=Ta();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=ba();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Ta();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,ka())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let r=wa();const s=Sa(),o=Sa();return t.forEach(((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof Ya)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Wa(o.mutation,t,o.mutation.getFieldMask(),Cs.now())):s.set(t.key,Xs.empty())})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new ru(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Sa();let i=new Gs(((e,t)=>e-t)),r=ka();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Xs.empty();o=r.applyToLocalView(s,o),n.set(e,o);const a=(i.get(r.batchId)||ka()).add(e);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=_a();c.forEach((e=>{if(!r.has(e)){const i=Ha(t.get(e),n.get(e));null!==i&&u.set(e,i),r=r.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Vs.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return Os.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):Vs.resolve(Ta());let o=-1,a=r;return s.next((t=>Vs.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?Vs.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,a,t,ka()))).next((e=>({batchId:o,changes:Ea(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Os(t)).next((e=>{let t=ba();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const i=t.collectionGroup;let r=ba();return this.indexManager.getCollectionParents(e,i).next((s=>Vs.forEach(s,(s=>{const o=function(e,t){return new ta(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i)))).next((e=>{i.forEach(((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Ao.newInvalidDocument(i)))}));let n=ba();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Wa(s.mutation,r,Xs.empty(),Cs.now()),pa(t,r)&&(n=n.insert(e,r))})),n}))}}class ou{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return Vs.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Rc(n.createTime)}),Vs.resolve()}getNamedQuery(e,t){return Vs.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:Yc(e.bundledQuery),readTime:Rc(e.readTime)}}(t)),Vs.resolve()}}class au{constructor(){this.overlays=new Gs(Os.comparator),this.ls=new Map}getOverlay(e,t){return Vs.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ta();return Vs.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.we(e,t,i)})),Vs.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.ls.delete(n)),Vs.resolve()}getOverlaysForCollection(e,t,n){const i=Ta(),r=t.length+1,s=new Os(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Vs.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new Gs(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=Ta(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ta(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return Vs.resolve(o)}we(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new ic(t,n));let r=this.ls.get(t);void 0===r&&(r=ka(),this.ls.set(t,r)),this.ls.set(t,r.add(n.key))}}class cu{constructor(){this.fs=new Js(uu.ds),this.ws=new Js(uu._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new uu(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.ys(new uu(e,t))}ps(e,t){e.forEach((e=>this.removeReference(e,t)))}Is(e){const t=new Os(new Ns([])),n=new uu(t,e),i=new uu(t,e+1),r=[];return this.ws.forEachInRange([n,i],(e=>{this.ys(e),r.push(e.key)})),r}Ts(){this.fs.forEach((e=>this.ys(e)))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new Os(new Ns([])),n=new uu(t,e),i=new uu(t,e+1);let r=ka();return this.ws.forEachInRange([n,i],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new uu(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class uu{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return Os.comparator(e.key,t.key)||_s(e.As,t.As)}static _s(e,t){return _s(e.As,t.As)||Os.comparator(e.key,t.key)}}class hu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new Js(uu.ds)}checkEmpty(e){return Vs.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const r=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new nc(r,t,n,i);this.mutationQueue.push(s);for(const t of i)this.Rs=this.Rs.add(new uu(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Vs.resolve(s)}lookupMutationBatch(e,t){return Vs.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.bs(n),r=i<0?0:i;return Vs.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Vs.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return Vs.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new uu(t,0),i=new uu(t,Number.POSITIVE_INFINITY),r=[];return this.Rs.forEachInRange([n,i],(e=>{const t=this.Ps(e.As);r.push(t)})),Vs.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Js(_s);return t.forEach((e=>{const t=new uu(e,0),i=new uu(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,i],(e=>{n=n.add(e.As)}))})),Vs.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;Os.isDocumentKey(r)||(r=r.child(""));const s=new uu(new Os(r),0);let o=new Js(_s);return this.Rs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.As)),!0)}),s),Vs.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach((e=>{const n=this.Ps(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){us(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return Vs.forEach(t.mutations,(i=>{const r=new uu(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Rs=n}))}Cn(e){}containsKey(e,t){const n=new uu(t,0),i=this.Rs.firstAfterOrEqual(n);return Vs.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Vs.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lu{constructor(e){this.Ds=e,this.docs=new Gs(Os.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Vs.resolve(n?n.document.mutableCopy():Ao.newInvalidDocument(t))}getEntries(e,t){let n=wa();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ao.newInvalidDocument(e))})),Vs.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=wa();const s=t.path,o=new Os(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Ms(Ps(o),n)<=0||(i.has(o.key)||pa(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return Vs.resolve(r)}getAllFromCollectionGroup(e,t,n,i){cs()}Cs(e,t){return Vs.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new du(this)}getSize(e){return Vs.resolve(this.size)}}class du extends iu{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(n)})),Vs.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class fu{constructor(e){this.persistence=e,this.xs=new ya((e=>Xo(e)),Zo),this.lastRemoteSnapshotVersion=ks.min(),this.highestTargetId=0,this.Ns=0,this.ks=new cu,this.targetCount=0,this.Ms=nu.kn()}forEachTarget(e,t){return this.xs.forEach(((e,n)=>t(n))),Vs.resolve()}getLastRemoteSnapshotVersion(e){return Vs.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Vs.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),Vs.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),Vs.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new nu(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,Vs.resolve()}updateTargetData(e,t){return this.Fn(t),Vs.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,Vs.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.xs.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Vs.waitFor(r).next((()=>i))}getTargetCount(e){return Vs.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return Vs.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),Vs.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach((t=>{r.push(i.markPotentiallyOrphaned(e,t))})),Vs.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),Vs.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return Vs.resolve(n)}containsKey(e,t){return Vs.resolve(this.ks.containsKey(t))}}class pu{constructor(e,t){this.$s={},this.overlays={},this.Os=new Bs(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new fu(this),this.indexManager=new Zc,this.remoteDocumentCache=function(e){return new lu(e)}((e=>this.referenceDelegate.Ls(e))),this.serializer=new Jc(t),this.qs=new ou(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new au,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new hu(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){rs("MemoryPersistence","Starting transaction:",e);const i=new gu(this.Os.next());return this.referenceDelegate.Us(),n(i).next((e=>this.referenceDelegate.Ks(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Gs(e,t){return Vs.or(Object.values(this.$s).map((n=>()=>n.containsKey(e,t))))}}class gu extends Fs{constructor(e){super(),this.currentSequenceNumber=e}}class mu{constructor(e){this.persistence=e,this.Qs=new cu,this.js=null}static zs(e){return new mu(e)}get Ws(){if(this.js)return this.js;throw cs()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),Vs.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),Vs.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),Vs.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach((e=>this.Ws.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ws.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Vs.forEach(this.Ws,(n=>{const i=Os.fromPath(n);return this.Hs(e,i).next((e=>{e||t.removeEntry(i,ks.min())}))})).next((()=>(this.js=null,t.apply(e))))}updateLimboDocument(e,t){return this.Hs(e,t).next((e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())}))}Ls(e){return 0}Hs(e,t){return Vs.or([()=>Vs.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class yu{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=i}static Li(e,t){let n=ka(),i=ka();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new yu(e,t.fromCache,n,i)}}class vu{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.Ki(e,t).next((r=>r||this.Gi(e,t,i,n))).next((n=>n||this.Qi(e,t)))}Ki(e,t){if(ia(t))return Vs.resolve(null);let n=ca(t);return this.indexManager.getIndexType(e,n).next((i=>0===i?null:(null!==t.limit&&1===i&&(t=ha(t,null,"F"),n=ca(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const r=ka(...i);return this.Ui.getDocuments(e,r).next((i=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.ji(t,i);return this.zi(t,s,r,n.readTime)?this.Ki(e,ha(t,null,"F")):this.Wi(e,s,t,n)}))))})))))}Gi(e,t,n,i){return ia(t)||i.isEqual(ks.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next((r=>{const s=this.ji(t,r);return this.zi(t,s,n,i)?this.Qi(e,t):(is()<=x.DEBUG&&rs("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),fa(t)),this.Wi(e,s,t,function(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,r=ks.fromTimestamp(1e9===i?new Cs(n+1,0):new Cs(n,i));return new Ls(r,Os.empty(),t)}(i,-1)))}))}ji(e,t){let n=new Js(ga(e));return t.forEach(((t,i)=>{pa(e,i)&&(n=n.add(i))})),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Qi(e,t){return is()<=x.DEBUG&&rs("QueryEngine","Using full collection scan to execute query:",fa(t)),this.Ui.getDocumentsMatchingQuery(e,t,Ls.min())}Wi(e,t,n,i){return this.Ui.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class wu{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new Gs(_s),this.Yi=new ya((e=>Xo(e)),Zo),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new su(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ji)))}}async function Iu(e,t){const n=hs(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((r=>(i=r,n.tr(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],s=[];let o=ka();for(const e of i){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({er:e,removedBatchIds:r,addedBatchIds:s})))}))}))}function bu(e){const t=hs(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Bs.getLastRemoteSnapshotVersion(e)))}async function Eu(e,t,n){const i=hs(e),r=i.Ji.get(t),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(e){if(!js(e))throw e;rs("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}i.Ji=i.Ji.remove(t),i.Yi.delete(r.target)}function Tu(e,t,n){const i=hs(e);let r=ks.min(),s=ka();return i.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const i=hs(e),r=i.Yi.get(n);return void 0!==r?Vs.resolve(i.Ji.get(r)):i.Bs.getTargetData(t,n)}(i,e,ca(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>i.Hi.getDocumentsMatchingQuery(e,t,n?r:ks.min(),n?s:ka()))).next((e=>(function(e,t,n){let i=e.Xi.get(t)||ks.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.Xi.set(t,i)}(i,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,ir:s})))))}class _u{constructor(){this.activeTargetIds=Aa}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Su{constructor(){this.Hr=new _u,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new _u,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cu{Yr(e){}shutdown(){}}class ku{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){rs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){rs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Au=null;function Nu(){return null===Au?Au=268435456+Math.round(2147483648*Math.random()):Au++,"0x"+Au.toString(16)}const Du={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ru{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Ou="WebChannelConnection";class Pu extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,i,r){const s=Nu(),o=this.To(e,t);rs("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={};return this.Eo(a,i,r),this.Ao(e,o,a,n).then((t=>(rs("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw os("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,i,r,s){return this.Io(e,t,n,i,r)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ts,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}To(e,t){const n=Du[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,i){const r=Nu();return new Promise(((s,o)=>{const a=new Jr;a.setWithCredentials(!0),a.listenOnce(Kr.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case zr.NO_ERROR:const t=a.getResponseJson();rs(Ou,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case zr.TIMEOUT:rs(Ou,`RPC '${e}' ${r} timed out`),o(new ds(ls.DEADLINE_EXCEEDED,"Request time out"));break;case zr.HTTP_ERROR:const n=a.getStatus();if(rs(Ou,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ls).indexOf(t)>=0?t:ls.UNKNOWN}(t.status);o(new ds(e,t.message))}else o(new ds(ls.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ds(ls.UNAVAILABLE,"Connection failed."));break;default:cs()}}finally{rs(Ou,`RPC '${e}' ${r} completed.`)}}));const c=JSON.stringify(i);rs(Ou,`RPC '${e}' ${r} sending request:`,i),a.send(t,"POST",c,n,15)}))}Ro(e,t,n){const i=Nu(),r=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=qr(),o=$r(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Wr({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=r.join("");rs(Ou,`Creating RPC '${e}' stream ${i}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new Ru({ro:t=>{d?rs(Ou,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(l||(rs(Ou,`Opening RPC '${e}' stream ${i} transport.`),h.open(),l=!0),rs(Ou,`RPC '${e}' stream ${i} sending:`,t),h.send(t))},oo:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(h,Qr.EventType.OPEN,(()=>{d||rs(Ou,`RPC '${e}' stream ${i} transport opened.`)})),p(h,Qr.EventType.CLOSE,(()=>{d||(d=!0,rs(Ou,`RPC '${e}' stream ${i} transport closed`),f.wo())})),p(h,Qr.EventType.ERROR,(t=>{d||(d=!0,os(Ou,`RPC '${e}' stream ${i} transport errored:`,t),f.wo(new ds(ls.UNAVAILABLE,"The operation could not be completed")))})),p(h,Qr.EventType.MESSAGE,(t=>{var n;if(!d){const r=t.data[0];us(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){rs(Ou,`RPC '${e}' stream ${i} received error:`,o);const t=o.status;let n=function(e){const t=sc[e];if(void 0!==t)return ac(t)}(t),r=o.message;void 0===n&&(n=ls.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),d=!0,f.wo(new ds(n,r)),h.close()}else rs(Ou,`RPC '${e}' stream ${i} received:`,r),f._o(r)}})),p(o,Hr.STAT_EVENT,(t=>{t.stat===Gr.PROXY?rs(Ou,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===Gr.NOPROXY&&rs(Ou,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.fo()}),0),f}}function Lu(){return"undefined"!=typeof document?document:null}function Mu(e){return new kc(e,!0)}class xu{constructor(e,t,n=1e3,i=1.5,r=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=i,this.Vo=r,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-n);i>0&&rs("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Co=Date.now(),e()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Fu{constructor(e,t,n,i,r,s,o,a){this.ii=e,this.$o=n,this.Oo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new xu(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===ls.RESOURCE_EXHAUSTED?(ss(t.toString()),ss("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===ls.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Fo===t&&this.Zo(e,n)}),(t=>{e((()=>{const e=new ds(ls.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)}))}))}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((e=>{n((()=>this.tu(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(e){return rs("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget((()=>this.Fo===e?t():(rs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Uu extends Fu{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:cs()}(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(us(void 0===t||"string"==typeof t),eo.fromBase64String(t||"")):(us(void 0===t||t instanceof Uint8Array),eo.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?ls.UNKNOWN:ac(e.code);return new ds(t,e.message||"")}(o);n=new wc(i,r,s,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=Lc(e,i.document.name),s=Rc(i.document.updateTime),o=i.document.createTime?Rc(i.document.createTime):ks.min(),a=new ko({mapValue:{fields:i.document.fields}}),c=Ao.newFoundDocument(r,s,o,a),u=i.targetIds||[],h=i.removedTargetIds||[];n=new yc(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=Lc(e,i.document),s=i.readTime?Rc(i.readTime):ks.min(),o=Ao.newNoDocument(r,s),a=i.removedTargetIds||[];n=new yc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=Lc(e,i.document),s=i.removedTargetIds||[];n=new yc([],s,r,null)}else{if(!("filter"in t))return cs();{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:r}=e,s=new rc(i,r),o=e.targetId;n=new vc(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ks.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ks.min():t.readTime?Rc(t.readTime):ks.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=xc(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=ea(i)?{documents:Uc(e,i)}:{query:Vc(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Dc(e,t.resumeToken);const i=Ac(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(ks.min())>0){n.readTime=Nc(e,t.snapshotVersion.toTimestamp());const i=Ac(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return cs()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=xc(this.serializer),t.removeTarget=e,this.Wo(t)}}class Vu extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new ds(ls.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Io(e,t,n,i,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ls.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ds(ls.UNKNOWN,e.toString())}))}vo(e,t,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.vo(e,t,n,r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ls.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ds(ls.UNKNOWN,e.toString())}))}terminate(){this.lu=!0}}class ju{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(ss(t),this.mu=!1):rs("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Bu{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=r,this.Pu.Yr((e=>{n.enqueueAndForget((async()=>{Ju(this)&&(rs("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=hs(e);t.vu.add(4),await $u(t),t.bu.set("Unknown"),t.vu.delete(4),await qu(t)}(this))}))})),this.bu=new ju(n,i)}}async function qu(e){if(Ju(e))for(const t of e.Ru)await t(!0)}async function $u(e){for(const t of e.Ru)await t(!1)}function zu(e,t){const n=hs(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),Qu(n)?Wu(n):ih(n).Ko()&&Hu(n,t))}function Ku(e,t){const n=hs(e),i=ih(n);n.Au.delete(t),i.Ko()&&Gu(n,t),0===n.Au.size&&(i.Ko()?i.jo():Ju(n)&&n.bu.set("Unknown"))}function Hu(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ks.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ih(e).su(t)}function Gu(e,t){e.Vu.qt(t),ih(e).iu(t)}function Wu(e){e.Vu=new bc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),ih(e).start(),e.bu.gu()}function Qu(e){return Ju(e)&&!ih(e).Uo()&&e.Au.size>0}function Ju(e){return 0===hs(e).vu.size}function Yu(e){e.Vu=void 0}async function Xu(e){e.Au.forEach(((t,n)=>{Hu(e,t)}))}async function Zu(e,t){Yu(e),Qu(e)?(e.bu.Iu(t),Wu(e)):e.bu.set("Unknown")}async function eh(e,t,n){if(e.bu.set("Online"),t instanceof wc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Au.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Au.delete(i),e.Vu.removeTarget(i))}(e,t)}catch(n){rs("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await th(e,n)}else if(t instanceof yc?e.Vu.Ht(t):t instanceof vc?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(ks.min()))try{const t=await bu(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Au.get(i);r&&e.Au.set(i,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const i=e.Au.get(t);if(!i)return;e.Au.set(t,i.withResumeToken(eo.EMPTY_BYTE_STRING,i.snapshotVersion)),Gu(e,t);const r=new Qc(i.target,t,n,i.sequenceNumber);Hu(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){rs("RemoteStore","Failed to raise snapshot:",t),await th(e,t)}}async function th(e,t,n){if(!js(t))throw t;e.vu.add(1),await $u(e),e.bu.set("Offline"),n||(n=()=>bu(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{rs("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await qu(e)}))}async function nh(e,t){const n=hs(e);n.asyncQueue.verifyOperationInProgress(),rs("RemoteStore","RemoteStore received new credentials");const i=Ju(n);n.vu.add(3),await $u(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await qu(n)}function ih(e){return e.Su||(e.Su=function(e,t,n){const i=hs(e);return i.fu(),new Uu(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{uo:Xu.bind(null,e),ao:Zu.bind(null,e),nu:eh.bind(null,e)}),e.Ru.push((async t=>{t?(e.Su.Qo(),Qu(e)?Wu(e):e.bu.set("Unknown")):(await e.Su.stop(),Yu(e))}))),e.Su}class rh{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new fs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new rh(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ds(ls.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sh(e,t){if(ss("AsyncQueue",`${t}: ${e}`),js(e))return new ds(ls.UNAVAILABLE,`${t}: ${e}`);throw e}class oh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Os.comparator(t.key,n.key):(e,t)=>Os.comparator(e.key,t.key),this.keyedMap=ba(),this.sortedSet=new Gs(this.comparator)}static emptySet(e){return new oh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof oh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new oh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ah{constructor(){this.Cu=new Gs(Os.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):cs():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ch{constructor(e,t,n,i,r,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,i,r){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new ch(e,t,oh.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&la(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class uh{constructor(){this.Nu=void 0,this.listeners=[]}}class hh{constructor(){this.queries=new ya((e=>da(e)),la),this.onlineState="Unknown",this.ku=new Set}}function lh(e,t){const n=hs(e);let i=!1;for(const e of t){const t=e.query,r=n.queries.get(t);if(r){for(const t of r.listeners)t.$u(e)&&(i=!0);r.Nu=e}}i&&fh(n)}function dh(e,t,n){const i=hs(e),r=i.queries.get(t);if(r)for(const e of r.listeners)e.onError(n);i.queries.delete(t)}function fh(e){e.ku.forEach((e=>{e.next()}))}class ph{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ch(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=ch.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class gh{constructor(e){this.key=e}}class mh{constructor(e){this.key=e}}class yh{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=ka(),this.mutatedKeys=ka(),this.tc=ga(e),this.ec=new oh(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new ah,i=t?t.ec:this.ec;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const u=i.get(e),h=pa(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.rc(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.tc(h,a)>0||c&&this.tc(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:o,mutatedKeys:r}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const r=e.ic.xu();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cs()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc))),this.oc(n);const s=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==r.length||a?{snapshot:new ch(this.query,e.ec,i,r,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new ah,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach((e=>this.Yu=this.Yu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Yu=this.Yu.delete(e))),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=ka(),this.ec.forEach((e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))}));const t=[];return e.forEach((e=>{this.Zu.has(e)||t.push(new mh(e))})),this.Zu.forEach((n=>{e.has(n)||t.push(new gh(n))})),t}hc(e){this.Yu=e.ir,this.Zu=ka();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return ch.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class vh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class wh{constructor(e){this.key=e,this.fc=!1}}class Ih{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new ya((e=>da(e)),la),this._c=new Map,this.mc=new Set,this.gc=new Gs(Os.comparator),this.yc=new Map,this.Ic=new cu,this.Tc={},this.Ec=new Map,this.Ac=nu.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function bh(e,t){const n=function(e){const t=hs(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Th.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ph.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sh.bind(null,t),t.dc.nu=lh.bind(null,t.eventManager),t.dc.Pc=dh.bind(null,t.eventManager),t}(e);let i,r;const s=n.wc.get(t);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.lc();else{const e=await function(e,t){const n=hs(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.Bs.getTargetData(e,t).next((r=>r?(i=r,Vs.resolve(i)):n.Bs.allocateTargetId(e).next((r=>(i=new Qc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.Ji.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e}))}(n.localStore,ca(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,r=await async function(e,t,n,i,r){e.Rc=(t,n,i)=>async function(e,t,n,i){let r=t.view.sc(n);r.zi&&(r=await Tu(e.localStore,t.query,!1).then((({documents:e})=>t.view.sc(e,r))));const s=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s);return Ah(e,t.targetId,o.cc),o.snapshot}(e,t,n,i);const s=await Tu(e.localStore,t,!0),o=new yh(t,s.ir),a=o.sc(s.documents),c=mc.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),u=o.applyChanges(a,e.isPrimaryClient,c);Ah(e,n,u.cc);const h=new vh(t,n,o);return e.wc.set(t,h),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}(n,t,i,"current"===s,e.resumeToken),n.isPrimaryClient&&zu(n.remoteStore,e)}return r}async function Eh(e,t){const n=hs(e),i=n.wc.get(t),r=n._c.get(i.targetId);if(r.length>1)return n._c.set(i.targetId,r.filter((e=>!la(e,t)))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Eu(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Ku(n.remoteStore,i.targetId),Ch(n,i.targetId)})).catch(Us)):(Ch(n,i.targetId),await Eu(n.localStore,i.targetId,!0))}async function Th(e,t){const n=hs(e);try{const e=await function(e,t){const n=hs(e),i=t.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Zi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];t.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.Bs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Bs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(eo.EMPTY_BYTE_STRING,ks.min()).withLastLimboFreeSnapshotVersion(ks.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,i)),r=r.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Bs.updateTargetData(e,u))}));let a=wa(),c=ka();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(function(e,t,n){let i=ka(),r=ka();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=wa();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(ks.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):rs("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{nr:i,sr:r}}))}(e,s,t.documentUpdates).next((e=>{a=e.nr,c=e.sr}))),!i.isEqual(ks.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next((t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return Vs.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ji=r,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.yc.get(t);i&&(us(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.fc=!0:e.modifiedDocuments.size>0?us(i.fc):e.removedDocuments.size>0&&(us(i.fc),i.fc=!1))})),await Rh(n,e,t)}catch(e){await Us(e)}}function _h(e,t,n){const i=hs(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.wc.forEach(((n,i)=>{const r=i.view.Mu(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=hs(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Mu(t)&&(i=!0)})),i&&fh(n)}(i.eventManager,t),e.length&&i.dc.nu(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Sh(e,t,n){const i=hs(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.yc.get(t),s=r&&r.key;if(s){let e=new Gs(Os.comparator);e=e.insert(s,Ao.newNoDocument(s,ks.min()));const n=ka().add(s),r=new gc(ks.min(),new Map,new Gs(_s),e,n);await Th(i,r),i.gc=i.gc.remove(s),i.yc.delete(t),Dh(i)}else await Eu(i.localStore,t,!1).then((()=>Ch(i,t,n))).catch(Us)}function Ch(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e._c.get(t))e.wc.delete(i),n&&e.dc.Pc(i,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach((t=>{e.Ic.containsKey(t)||kh(e,t)}))}function kh(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(Ku(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Dh(e))}function Ah(e,t,n){for(const i of n)i instanceof gh?(e.Ic.addReference(i.key,t),Nh(e,i)):i instanceof mh?(rs("SyncEngine","Document no longer in limbo: "+i.key),e.Ic.removeReference(i.key,t),e.Ic.containsKey(i.key)||kh(e,i.key)):cs()}function Nh(e,t){const n=t.key,i=n.path.canonicalString();e.gc.get(n)||e.mc.has(i)||(rs("SyncEngine","New document in limbo: "+n),e.mc.add(i),Dh(e))}function Dh(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new Os(Ns.fromString(t)),i=e.Ac.next();e.yc.set(i,new wh(n)),e.gc=e.gc.insert(n,i),zu(e.remoteStore,new Qc(ca(na(n.path)),i,"TargetPurposeLimboResolution",Bs.ct))}}async function Rh(e,t,n){const i=hs(e),r=[],s=[],o=[];i.wc.isEmpty()||(i.wc.forEach(((e,a)=>{o.push(i.Rc(a,t,n).then((e=>{if((e||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){r.push(e);const t=yu.Li(a.targetId,e);s.push(t)}})))})),await Promise.all(o),i.dc.nu(r),await async function(e,t){const n=hs(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Vs.forEach(t,(t=>Vs.forEach(t.Fi,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>Vs.forEach(t.Bi,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!js(e))throw e;rs("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ji.get(t),i=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(t,r)}}}(i.localStore,s))}async function Oh(e,t){const n=hs(e);if(!n.currentUser.isEqual(t)){rs("SyncEngine","User change. New user:",t.toKey());const e=await Iu(n.localStore,t);n.currentUser=t,function(e,t){e.Ec.forEach((e=>{e.forEach((e=>{e.reject(new ds(ls.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Rh(n,e.er)}}function Ph(e,t){const n=hs(e),i=n.yc.get(t);if(i&&i.fc)return ka().add(i.key);{let e=ka();const i=n._c.get(t);if(!i)return e;for(const t of i){const i=n.wc.get(t);e=e.unionWith(i.view.nc)}return e}}class Lh{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Mu(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,i){return new wu(e,t,n,i)}(this.persistence,new vu,e.initialUser,this.serializer)}createPersistence(e){return new pu(mu.zs,this.serializer)}createSharedClientState(e){return new Su}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Mh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>_h(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Oh.bind(null,this.syncEngine),await async function(e,t){const n=hs(e);t?(n.vu.delete(2),await qu(n)):t||(n.vu.add(2),await $u(n),n.bu.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hh}createDatastore(e){const t=Mu(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Pu(i));var i;return function(e,t,n,i){return new Vu(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>_h(this.syncEngine,e,0),s=ku.D()?new ku:new Cu,new Bu(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new Ih(e,t,n,i,r,s);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=hs(e);rs("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await $u(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class xh{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):ss("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Fh{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=es.UNAUTHENTICATED,this.clientId=Ts.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{rs("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(rs("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ds(ls.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=sh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Uh(e,t){e.asyncQueue.verifyOperationInProgress(),rs("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await Iu(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Vh(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rs("FirestoreClient","Using user provided OfflineComponentProvider");try{await Uh(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===ls.FAILED_PRECONDITION||e.code===ls.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;os("Error using user provided cache. Falling back to memory cache: "+n),await Uh(e,new Lh)}}else rs("FirestoreClient","Using default OfflineComponentProvider"),await Uh(e,new Lh);return e._offlineComponents}(e);rs("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener((e=>nh(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>nh(t.remoteStore,n))),e._onlineComponents=t}async function jh(e){const t=await async function(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(rs("FirestoreClient","Using user provided OnlineComponentProvider"),await Vh(e,e._uninitializedComponentsProvider._online)):(rs("FirestoreClient","Using default OnlineComponentProvider"),await Vh(e,new Mh))),e._onlineComponents}(e),n=t.eventManager;return n.onListen=bh.bind(null,t.syncEngine),n.onUnlisten=Eh.bind(null,t.syncEngine),n}function Bh(e,t,n={}){const i=new fs;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,r){const s=new xh({next:n=>{t.enqueueAndForget((()=>async function(e,t){const n=hs(e),i=t.query;let r=!1;const s=n.queries.get(i);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}(e,o))),n.fromCache&&"server"===i.source?r.reject(new ds(ls.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new ph(n,s,{includeMetadataChanges:!0,Ku:!0});return async function(e,t){const n=hs(e),i=t.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new uh),r)try{s.Nu=await n.onListen(i)}catch(e){const n=sh(e,`Initialization of query '${fa(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.listeners.push(t),t.Mu(n.onlineState),s.Nu&&t.$u(s.Nu)&&fh(n)}(e,o)}(await jh(e),e.asyncQueue,t,n,i))),i.promise}function qh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const $h=new Map;function zh(e){if(Os.isDocumentKey(e))throw new ds(ls.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Kh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":cs()}function Hh(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ds(ls.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Kh(e);throw new ds(ls.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Gh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ds(ls.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ds(ls.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new ds(ls.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=qh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ds(ls.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ds(ls.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ds(ls.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Wh{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ds(ls.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ds(ls.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gh(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new gs;switch(e.type){case"firstParty":return new ws(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ds(ls.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=$h.get(e);t&&(rs("ComponentProvider","Removing Datastore"),$h.delete(e),t.terminate())}(this),Promise.resolve()}}class Qh{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qh(this.firestore,e,this._key)}}class Jh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Jh(this.firestore,e,this._query)}}class Yh extends Jh{constructor(e,t,n){super(e,t,na(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qh(this.firestore,null,new Os(e))}withConverter(e){return new Yh(this.firestore,e,this._path)}}function Xh(e,t,...n){if(e=D(e),function(e,t,n){if(!n)throw new ds(ls.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}("collection","path",t),e instanceof Wh){const i=Ns.fromString(t,...n);return zh(i),new Yh(e,null,i)}{if(!(e instanceof Qh||e instanceof Yh))throw new ds(ls.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(Ns.fromString(t,...n));return zh(i),new Yh(e.firestore,null,i)}}class Zh{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new xu(this,"async_queue_retry"),this.Xc=()=>{const e=Lu();e&&rs("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=Lu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Lu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise((()=>{}));const t=new fs;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Qc.push(e),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!js(e))throw e;rs("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(e){const t=this.Gc.then((()=>(this.Hc=!0,e().catch((e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ss("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Hc=!1,e))))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=rh.createAndSchedule(this,e,t,n,(e=>this.na(e)));return this.zc.push(i),i}Zc(){this.Wc&&cs()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then((()=>{this.zc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()}))}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}class el extends Wh{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Zh,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||tl(this),this._firestoreClient.terminate()}}function tl(e){var t,n,i;const r=e._freezeSettings(),s=function(e,t,n,i){return new co(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,qh(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,r);e._firestoreClient=new Fh(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=r.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.cache.kind,_offline:r.cache._offlineComponentProvider,_online:r.cache._onlineComponentProvider})}class nl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new nl(eo.fromBase64String(e))}catch(e){throw new ds(ls.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new nl(eo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class il{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ds(ls.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class rl{constructor(e){this._methodName=e}}class sl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ds(ls.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ds(ls.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return _s(this._lat,e._lat)||_s(this._long,e._long)}}const ol=/^__.*__$/;function al(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cs()}}class cl{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.ua(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new cl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.fa(e),i}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return fl(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(al(this.ca)&&ol.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class ul{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Mu(e)}ya(e,t,n,i=!1){return new cl({ca:e,methodName:t,ga:n,path:Rs.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hl(e,t){if(ll(e=D(e)))return function(e,t,n){if(!ll(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=Kh(n);throw"an object"===i?t._a(e+" a custom object"):t._a(e+" "+i)}}("Unsupported field value:",t,e),function(e,t){const n={};return Hs(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ks(e,((e,i)=>{const r=hl(i,t.ha(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}(e,t);if(e instanceof rl)return function(e,t){if(!al(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=hl(r,t.wa(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=D(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ra(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Cs.fromDate(e);return{timestampValue:Nc(t.serializer,n)}}if(e instanceof Cs){const n=new Cs(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Nc(t.serializer,n)}}if(e instanceof sl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof nl)return{bytesValue:Dc(t.serializer,e._byteString)};if(e instanceof Qh){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Oc(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Kh(e)}`)}(e,t)}function ll(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Cs||e instanceof sl||e instanceof nl||e instanceof Qh||e instanceof rl)}const dl=new RegExp("[~\\*/\\[\\]]");function fl(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new ds(ls.INVALID_ARGUMENT,a+e+c)}class pl{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Qh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new gl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ml("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class gl extends pl{data(){return super.data()}}function ml(e,t){return"string"==typeof t?function(e,t,n){if(t.search(dl)>=0)throw fl(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new il(...t.split("."))._internalPath}catch(i){throw fl(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}(e,t):t instanceof il?t._internalPath:t._delegate._internalPath}class yl{}class vl extends yl{}function wl(e,t,...n){let i=[];t instanceof yl&&i.push(t),i=i.concat(n),function(e){const t=e.filter((e=>e instanceof bl)).length,n=e.filter((e=>e instanceof Il)).length;if(t>1||t>0&&n>0)throw new ds(ls.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const t of i)e=t._apply(e);return e}class Il extends vl{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Il(e,t,n)}_apply(e){const t=this._parse(e);return _l(e._query,t),new Jh(e.firestore,e.converter,ua(e._query,t))}_parse(e){const t=function(e){const t=e._freezeSettings(),n=Mu(e._databaseId);return new ul(e._databaseId,!!t.ignoreUndefinedProperties,n)}(e.firestore),n=function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ds(ls.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Tl(o,s);const t=[];for(const n of o)t.push(El(i,e,n));a={arrayValue:{values:t}}}else a=El(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Tl(o,s),a=function(e,t,n,i=!1){return hl(n,e.ya(i?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return Mo.create(r,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class bl extends yl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new bl(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:xo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const e of i)_l(n,e),n=ua(n,e)}(e._query,t),new Jh(e.firestore,e.converter,ua(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function El(e,t,n){if("string"==typeof(n=D(n))){if(""===n)throw new ds(ls.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!oa(t)&&-1!==n.indexOf("/"))throw new ds(ls.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(Ns.fromString(n));if(!Os.isDocumentKey(i))throw new ds(ls.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return wo(e,new Os(i))}if(n instanceof Qh)return wo(e,n._key);throw new ds(ls.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Kh(n)}.`)}function Tl(e,t){if(!Array.isArray(e)||0===e.length)throw new ds(ls.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function _l(e,t){if(t.isInequality()){const n=sa(e),i=t.field;if(null!==n&&!n.isEqual(i))throw new ds(ls.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);const r=ra(e);null!==r&&function(e,t,n){if(!n.isEqual(t))throw new ds(ls.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}(0,i,r)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ds(ls.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ds(ls.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Sl{convertValue(e,t="none"){switch(lo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return io(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ro(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw cs()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Ks(e,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertGeoPoint(e){return new sl(io(e.latitude),io(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=oo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ao(e));default:return null}}convertTimestamp(e){const t=no(e);return new Cs(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ns.fromString(e);us(Wc(n));const i=new uo(n.get(1),n.get(3)),r=new Os(n.popFirst(5));return i.isEqual(t)||ss(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class Cl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class kl extends pl{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Al(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(ml("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Al extends kl{data(e={}){return super.data(e)}}class Nl{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Cl(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Al(this._firestore,this._userDataWriter,n.key,n,new Cl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ds(ls.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const i=new Al(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Cl(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new Al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Cl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Dl(t.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Dl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cs()}}class Rl extends Sl{constructor(e){super(),this.firestore=e}convertBytes(e){return new nl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Qh(this.firestore,null,t)}}function Ol(e){e=Hh(e,Jh);const t=Hh(e.firestore,el),n=function(e){return e._firestoreClient||tl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}(t),i=new Rl(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ds(ls.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),Bh(n,e._query).then((n=>new Nl(t,i,e,n)))}function Pl(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}!function(e,t=!0){!function(e){ts=e}(we),ge(new R("firestore",((e,{instanceIdentifier:n,options:i})=>{const r=e.getProvider("app").getImmediate(),s=new el(new ys(e.getProvider("auth-internal")),new bs(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ds(ls.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uo(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),Ee(Zr,"3.13.0",e),Ee(Zr,"3.13.0","esm2017")}(),Ee("firebase","9.23.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Ll=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Ml=new m("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),xl=new q("@firebase/auth");function Fl(e,...t){xl.logLevel<=x.ERROR&&xl.error(`Auth (${we}): ${e}`,...t)}function Ul(e,...t){throw jl(e,...t)}function Vl(e,...t){return jl(e,...t)}function jl(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Ml.create(e,...t)}function Bl(e,t,...n){if(!e)throw jl(t,...n)}function ql(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Fl(t),new Error(t)}function $l(e,t){e||ql(t)}function zl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Kl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Hl{constructor(e,t){this.shortDelay=e,this.longDelay=t,$l(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Kl()||"https:"===Kl()||d()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Gl(e,t){$l(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Wl{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void ql("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void ql("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void ql("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ql={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Jl=new Hl(3e4,6e4);function Yl(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Xl(e,t,n,i,r={}){return Zl(e,r,(async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=I(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Wl.fetch()(td(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},r))}))}async function Zl(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Ql),t);try{const t=new nd(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw id(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw id(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw id(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw id(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const i=Object.assign(Object.assign({},Ll()),{[t]:n});return new m("auth","Firebase",i).create(t,{appName:e.name})}(e,a,o);Ul(e,a)}}catch(t){if(t instanceof g)throw t;Ul(e,"network-request-failed",{message:String(t)})}}async function ed(e,t,n,i,r={}){const s=await Xl(e,t,n,i,r);return"mfaPendingCredential"in s&&Ul(e,"multi-factor-auth-required",{_serverResponse:s}),s}function td(e,t,n,i){const r=`${t}${n}?${i}`;return e.config.emulator?Gl(e.config,r):`${e.config.apiScheme}://${r}`}class nd{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Vl(this.auth,"network-request-failed"))),Jl.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function id(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=Vl(e,t,i);return r.customData._tokenResponse=n,r}function rd(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function sd(e){return 1e3*Number(e)}function od(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return Fl("JWT malformed, contained fewer than 3 sections"),null;try{const e=s(n);return e?JSON.parse(e):(Fl("Failed to decode base64 JWT payload"),null)}catch(e){return Fl("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function ad(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class cd{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class ud{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rd(this.lastLoginAt),this.creationTime=rd(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function hd(e){var t;const n=e.auth,i=await e.getIdToken(),r=await ad(e,async function(e,t){return Xl(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));Bl(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Pl(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ud(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class ld{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Bl(e.idToken,"internal-error"),Bl(void 0!==e.idToken,"internal-error"),Bl(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=od(e);return Bl(t,"internal-error"),Bl(void 0!==t.exp,"internal-error"),Bl(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Bl(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await Zl(e,{},(async()=>{const n=I({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=td(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Wl.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new ld;return n&&(Bl("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(Bl("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(Bl("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ld,this.toJSON())}_performRefresh(){return ql("not implemented")}}function dd(e,t){Bl("string"==typeof e||void 0===e,"internal-error",{appName:t})}class fd{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=Pl(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new ud(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await ad(this,this.stsTokenManager.getToken(this.auth,e));return Bl(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=D(e),i=await n.getIdToken(t),r=od(i);Bl(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:rd(sd(r.auth_time)),issuedAtTime:rd(sd(r.iat)),expirationTime:rd(sd(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=D(e);await hd(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Bl(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new fd(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Bl(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await hd(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ad(this,async function(e,t){return Xl(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:E}=t;Bl(v&&E,e,"internal-error");const T=ld.fromJSON(this.name,E);Bl("string"==typeof v,e,"internal-error"),dd(h,e.name),dd(l,e.name),Bl("boolean"==typeof w,e,"internal-error"),Bl("boolean"==typeof I,e,"internal-error"),dd(d,e.name),dd(f,e.name),dd(p,e.name),dd(g,e.name),dd(m,e.name),dd(y,e.name);const _=new fd({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(_.providerData=b.map((e=>Object.assign({},e)))),g&&(_._redirectEventId=g),_}static async _fromIdTokenResponse(e,t,n=!1){const i=new ld;i.updateFromServerResponse(t);const r=new fd({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await hd(r),r}}const pd=new Map;function gd(e){$l(e instanceof Function,"Expected a class definition");let t=pd.get(e);return t?($l(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,pd.set(e,t),t)}class md{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}md.type="NONE";const yd=md;function vd(e,t,n){return`firebase:${e}:${t}:${n}`}class wd{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=vd(this.userKey,i.apiKey,r),this.fullPersistenceKey=vd("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?fd._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new wd(gd(yd),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=i[0]||gd(yd);const s=vd(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const i=fd._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new wd(r,e,n)):new wd(r,e,n)}}function Id(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(_d(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(bd(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Cd(t))return"Blackberry";if(kd(t))return"Webos";if(Ed(t))return"Safari";if((t.includes("chrome/")||Td(t))&&!t.includes("edge/"))return"Chrome";if(Sd(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function bd(e=l()){return/firefox\//i.test(e)}function Ed(e=l()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Td(e=l()){return/crios\//i.test(e)}function _d(e=l()){return/iemobile/i.test(e)}function Sd(e=l()){return/android/i.test(e)}function Cd(e=l()){return/blackberry/i.test(e)}function kd(e=l()){return/webos/i.test(e)}function Ad(e=l()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Nd(e=l()){return Ad(e)||Sd(e)||kd(e)||Cd(e)||/windows phone/i.test(e)||_d(e)}function Dd(e,t=[]){let n;switch(e){case"Browser":n=Id(l());break;case"Worker":n=`${Id(l())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${we}/${i}`}async function Rd(e,t){return Xl(e,"GET","/v2/recaptchaConfig",Yl(e,t))}function Od(e){return void 0!==e&&void 0!==e.enterprise}class Pd{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}function Ld(e){return new Promise(((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=Vl("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)}))}function Md(e){return`__${e}${Math.floor(1e6*Math.random())}`}class xd{constructor(e){this.type="recaptcha-enterprise",this.auth=jd(e)}async verify(e="verify",t=!1){function n(t,n,i){const r=window.grecaptcha;Od(r)?r.enterprise.ready((()=>{r.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{Rd(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new Pd(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((r=>{if(!t&&Od(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));Ld("https://www.google.com/recaptcha/enterprise.js?render="+r).then((()=>{n(r,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Fd(e,t,n,i=!1){const r=new xd(e);let s;try{s=await r.verify(n)}catch(e){s=await r.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class Ud{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Vd{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bd(this),this.idTokenSubscription=new Bd(this),this.beforeStateQueue=new Ud(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ml,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gd(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await wd.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Bl(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await hd(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?D(e):null;return t&&Bl(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Bl(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(gd(e))}))}async initializeRecaptchaConfig(){const e=await Rd(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new Pd(e);null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled&&new xd(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new m("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&gd(e)||this._popupRedirectResolver;Bl(t,this,"argument-error"),this.redirectPersistenceManager=await wd.create(this,[gd(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Bl(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Bl(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Dd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){xl.logLevel<=x.WARN&&xl.warn(`Auth (${we}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function jd(e){return D(e)}class Bd{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new T(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Bl(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function qd(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $d(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class zd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ql("not implemented")}_getIdTokenResponse(e){return ql("not implemented")}_linkToIdToken(e,t){return ql("not implemented")}_getReauthenticationResolver(e){return ql("not implemented")}}async function Kd(e,t){return ed(e,"POST","/v1/accounts:signInWithPassword",Yl(e,t))}class Hd extends zd{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Hd(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Hd(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Fd(e,n,"signInWithPassword");return Kd(e,t)}return Kd(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Fd(e,n,"signInWithPassword");return Kd(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return ed(e,"POST","/v1/accounts:signInWithEmailLink",Yl(e,t))}(e,{email:this._email,oobCode:this._password});default:Ul(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return Xl(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ed(e,"POST","/v1/accounts:signInWithEmailLink",Yl(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ul(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Gd(e,t){return ed(e,"POST","/v1/accounts:signInWithIdp",Yl(e,t))}class Wd extends zd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Wd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ul("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=Pl(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new Wd(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return Gd(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Gd(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Gd(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=I(t)}return e}}const Qd={USER_NOT_FOUND:"user-not-found"};class Jd extends zd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Jd({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Jd({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ed(e,"POST","/v1/accounts:signInWithPhoneNumber",Yl(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ed(e,"POST","/v1/accounts:signInWithPhoneNumber",Yl(e,t));if(n.temporaryProof)throw id(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ed(e,"POST","/v1/accounts:signInWithPhoneNumber",Yl(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Qd)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new Jd({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class Yd{constructor(e){var t,n,i,r,s,o;const a=b(E(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Bl(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=b(E(e)).link,n=t?b(E(t)).deep_link_id:null,i=b(E(e)).deep_link_id;return(i?b(E(i)).link:null)||i||n||t||e}(e);try{return new Yd(t)}catch(e){return null}}}class Xd{constructor(){this.providerId=Xd.PROVIDER_ID}static credential(e,t){return Hd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Yd.parseLink(t);return Bl(n,"argument-error"),Hd._fromEmailAndCode(e,n.code,n.tenantId)}}Xd.PROVIDER_ID="password",Xd.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Xd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Zd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ef extends Zd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class tf extends ef{constructor(){super("facebook.com")}static credential(e){return Wd._fromParams({providerId:tf.PROVIDER_ID,signInMethod:tf.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tf.credentialFromTaggedObject(e)}static credentialFromError(e){return tf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return tf.credential(e.oauthAccessToken)}catch(e){return null}}}tf.FACEBOOK_SIGN_IN_METHOD="facebook.com",tf.PROVIDER_ID="facebook.com";class nf extends ef{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Wd._fromParams({providerId:nf.PROVIDER_ID,signInMethod:nf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nf.credentialFromTaggedObject(e)}static credentialFromError(e){return nf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return nf.credential(t,n)}catch(e){return null}}}nf.GOOGLE_SIGN_IN_METHOD="google.com",nf.PROVIDER_ID="google.com";class rf extends ef{constructor(){super("github.com")}static credential(e){return Wd._fromParams({providerId:rf.PROVIDER_ID,signInMethod:rf.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rf.credentialFromTaggedObject(e)}static credentialFromError(e){return rf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return rf.credential(e.oauthAccessToken)}catch(e){return null}}}rf.GITHUB_SIGN_IN_METHOD="github.com",rf.PROVIDER_ID="github.com";class sf extends ef{constructor(){super("twitter.com")}static credential(e,t){return Wd._fromParams({providerId:sf.PROVIDER_ID,signInMethod:sf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return sf.credentialFromTaggedObject(e)}static credentialFromError(e){return sf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return sf.credential(t,n)}catch(e){return null}}}sf.TWITTER_SIGN_IN_METHOD="twitter.com",sf.PROVIDER_ID="twitter.com";class of{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const r=await fd._fromIdTokenResponse(e,n,i),s=af(n);return new of({user:r,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=af(n);return new of({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function af(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class cf extends g{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,cf.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new cf(e,t,n,i)}}function uf(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw cf._fromErrorAndOperation(e,n,t,i);throw n}))}new WeakMap;const hf="__sak";class lf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(hf,"1"),this.storage.removeItem(hf),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class df extends lf{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=l();return Ed(e)||Ad(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Nd(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=l();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}df.type="LOCAL";const ff=df;class pf extends lf{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pf.type="SESSION";const gf=pf;class mf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new mf(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async e=>e(t.origin,r))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function yf(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}mf.receivers=[];class vf{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=yf("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(u),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function wf(){return window}function If(){return void 0!==wf().WorkerGlobalScope&&"function"==typeof wf().importScripts}const bf="firebaseLocalStorageDb",Ef="firebaseLocalStorage",Tf="fbase_key";class _f{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Sf(e,t){return e.transaction([Ef],t?"readwrite":"readonly").objectStore(Ef)}function Cf(){const e=indexedDB.open(bf,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Ef,{keyPath:Tf})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Ef)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(bf);return new _f(e).toPromise()}(),t(await Cf()))}))}))}async function kf(e,t,n){const i=Sf(e,!0).put({[Tf]:t,value:n});return new _f(i).toPromise()}function Af(e,t){const n=Sf(e,!0).delete(t);return new _f(n).toPromise()}class Nf{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Cf()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return If()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=mf._getInstance(If()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new vf(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}var t}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Cf();return await kf(e,hf,"1"),await Af(e,hf),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>kf(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Sf(e,!1).get(t),i=await new _f(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Af(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Sf(e,!1).getAll();return new _f(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Nf.type="LOCAL";const Df=Nf;Md("rcb"),new Hl(3e4,6e4);class Rf{constructor(e){this.providerId=Rf.PROVIDER_ID,this.auth=jd(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const r=await n.verify();try{let s;if(Bl("string"==typeof r,e,"argument-error"),Bl("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Bl("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Xl(e,"POST","/v2/accounts/mfaEnrollment:start",Yl(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{Bl("signin"===t.type,e,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;Bl(n,e,"missing-multi-factor-info");const o=await function(e,t){return Xl(e,"POST","/v2/accounts/mfaSignIn:start",Yl(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Xl(e,"POST","/v1/accounts:sendVerificationCode",Yl(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:r});return t}}finally{n._reset()}}(this.auth,e,D(t))}static credential(e,t){return Jd._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Rf.credentialFromTaggedObject(t)}static credentialFromError(e){return Rf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Jd._fromTokenResponse(t,n):null}}Rf.PROVIDER_ID="phone",Rf.PHONE_SIGN_IN_METHOD="phone";class Of extends zd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Gd(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Gd(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Gd(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Pf(e){return async function(e,t,n=!1){const i="signIn",r=await uf(e,i,t),s=await of._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Of(e),e.bypassAuthState)}function Lf(e){const{auth:t,user:n}=e;return Bl(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e,r="reauthenticate";try{const s=await ad(e,uf(i,r,t,e),n);Bl(s.idToken,i,"internal-error");const o=od(s.idToken);Bl(o,i,"internal-error");const{sub:a}=o;return Bl(e.uid===a,i,"user-mismatch"),of._forOperation(e,r,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Ul(i,"user-mismatch"),e}}(n,new Of(e),e.bypassAuthState)}async function Mf(e){const{auth:t,user:n}=e;return Bl(n,t,"internal-error"),async function(e,t,n=!1){const i=await ad(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return of._forOperation(e,"link",i)}(n,new Of(e),e.bypassAuthState)}class xf{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Pf;case"linkViaPopup":case"linkViaRedirect":return Mf;case"reauthViaPopup":case"reauthViaRedirect":return Lf;default:Ul(this.auth,"internal-error")}}resolve(e){$l(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$l(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ff=new Hl(2e3,1e4);class Uf extends xf{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,Uf.currentPopupAction&&Uf.currentPopupAction.cancel(),Uf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Bl(e,this.auth,"internal-error"),e}async onExecution(){$l(1===this.filter.length,"Popup operations only handle one event");const e=yf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Vl(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Vl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Uf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Vl(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Ff.get())};e()}}Uf.currentPopupAction=null;const Vf="pendingRedirect",jf=new Map;class Bf extends xf{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=jf.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return vd(Vf,e.config.apiKey,e.name)}(t),i=function(e){return gd(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}jf.set(this.auth._key(),e)}return this.bypassAuthState||jf.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function qf(e,t){jf.set(e._key(),t)}async function $f(e,t,n=!1){const i=jd(e),r=function(e,t){return t?gd(t):(Bl(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),s=new Bf(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class zf{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hf(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Hf(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Vl(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Kf(e))}saveEventToCache(e){this.cachedEventUids.add(Kf(e)),this.lastProcessedEventTime=Date.now()}}function Kf(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Hf({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Gf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Wf=/^https?/;function Qf(e){const t=zl(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!Wf.test(n))return!1;if(Gf.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Jf=new Hl(3e4,6e4);function Yf(){const e=wf().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Xf=null;function Zf(e){return Xf=Xf||function(e){return new Promise(((t,n)=>{var i,r,s;function o(){Yf(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Yf(),n(Vl(e,"network-request-failed"))},timeout:Jf.get()})}if(null===(r=null===(i=wf().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=wf().gapi)||void 0===s?void 0:s.load)){const t=Md("iframefcb");return wf()[t]=()=>{gapi.load?o():n(Vl(e,"network-request-failed"))},Ld(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Xf=null,e}))}(e),Xf}const ep=new Hl(5e3,15e3),tp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},np=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ip(e){const t=e.config;Bl(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Gl(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:we},r=np.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${I(i).slice(1)}`}const rp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class sp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const op=encodeURIComponent("fac");async function ap(e,t,n,i,r,s){Bl(e.config.authDomain,e,"auth-domain-config-required"),Bl(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:we,eventId:r};if(t instanceof Zd){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof ef){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${op}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Gl(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${I(a).slice(1)}${u}`}const cp="webStorageSupport",up=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=gf,this._completeRedirectFn=$f,this._overrideRedirectResult=qf}async _openPopup(e,t,n,i){var r;return $l(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},rp),{width:i.toString(),height:r.toString(),top:s,left:o}),u=l().toLowerCase();n&&(a=Td(u)?"_blank":n),bd(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=l()){var t;return Ad(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new sp(null);const d=window.open(t||"",a,h);Bl(d,e,"popup-blocked");try{d.focus()}catch(e){}return new sp(d)}(e,await ap(e,t,n,zl(),i),yf())}async _openRedirect(e,t,n,i){return await this._originValidation(e),r=await ap(e,t,n,zl(),i),wf().location.href=r,new Promise((()=>{}));var r}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):($l(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Zf(e),n=wf().gapi;return Bl(n,e,"internal-error"),t.open({where:document.body,url:ip(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:tp,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const r=Vl(e,"network-request-failed"),s=wf().setTimeout((()=>{i(r)}),ep.get());function o(){wf().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{i(r)}))}))))}(e),n=new zf(e);return t.register("authEvent",(t=>(Bl(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(cp,{type:cp},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[cp];void 0!==r&&t(!!r),Ul(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Xl(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Qf(e))return}catch(e){}Ul(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Nd()||Ed()||Ad()}};var hp="@firebase/auth",lp="0.23.2";class dp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Bl(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const fp=u("authIdTokenMaxAge")||300;let pp=null;var gp;gp="Browser",ge(new R("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Bl(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:gp,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Dd(gp)},c=new Vd(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(gd);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ge(new R("auth-internal",(e=>(e=>new dp(e))(jd(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Ee(hp,lp,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(gp)),Ee(hp,lp,"esm2017");const mp=(e,t)=>t.some((t=>e instanceof t));let yp,vp;const wp=new WeakMap,Ip=new WeakMap,bp=new WeakMap,Ep=new WeakMap,Tp=new WeakMap;let _p={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Ip.get(e);if("objectStoreNames"===t)return e.objectStoreNames||bp.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Cp(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Sp(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(vp||(vp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(kp(this),e),Cp(wp.get(this))}:function(...e){return Cp(t.apply(kp(this),e))}:function(e,...n){const i=t.call(kp(this),e,...n);return bp.set(i,e.sort?e.sort():[e]),Cp(i)}:(e instanceof IDBTransaction&&function(e){if(Ip.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));Ip.set(e,t)}(e),mp(e,yp||(yp=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,_p):e);var t}function Cp(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(Cp(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&wp.set(t,e)})).catch((()=>{})),Tp.set(t,e),t}(e);if(Ep.has(e))return Ep.get(e);const t=Sp(e);return t!==e&&(Ep.set(e,t),Tp.set(t,e)),t}const kp=e=>Tp.get(e),Ap=["get","getKey","getAll","getAllKeys","count"],Np=["put","add","delete","clear"],Dp=new Map;function Rp(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Dp.get(t))return Dp.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Np.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Ap.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return Dp.set(t,s),s}_p=(e=>({...e,get:(t,n,i)=>Rp(t,n)||e.get(t,n,i),has:(t,n)=>!!Rp(t,n)||e.has(t,n)}))(_p);const Op="@firebase/installations",Pp="0.6.4",Lp=1e4,Mp=`w:${Pp}`,xp="FIS_v2",Fp="https://firebaseinstallations.googleapis.com/v1",Up=36e5,Vp=new m("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function jp(e){return e instanceof g&&e.code.includes("request-failed")}function Bp({projectId:e}){return`${Fp}/projects/${e}/installations`}function qp(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function $p(e,t){const n=(await t.json()).error;return Vp.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function zp({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Kp(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Hp(e){return new Promise((t=>{setTimeout(t,e)}))}const Gp=/^[cdef][\w-]{21}$/,Wp="";function Qp(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Gp.test(t)?t:Wp}catch(e){return Wp}}function Jp(e){return`${e.appName}!${e.appId}`}const Yp=new Map;function Xp(e,t){const n=Jp(e);Zp(n,t),function(e,t){const n=(!eg&&"BroadcastChannel"in self&&(eg=new BroadcastChannel("[Firebase] FID Change"),eg.onmessage=e=>{Zp(e.data.key,e.data.fid)}),eg);n&&n.postMessage({key:e,fid:t}),0===Yp.size&&eg&&(eg.close(),eg=null)}(n,t)}function Zp(e,t){const n=Yp.get(e);if(n)for(const e of n)e(t)}let eg=null;const tg="firebase-installations-database",ng=1,ig="firebase-installations-store";let rg=null;function sg(){return rg||(rg=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=Cp(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(Cp(o.result),e.oldVersion,e.newVersion,Cp(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}(tg,ng,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ig)}})),rg}async function og(e,t){const n=Jp(e),i=(await sg()).transaction(ig,"readwrite"),r=i.objectStore(ig),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||Xp(e,t.fid),t}async function ag(e){const t=Jp(e),n=(await sg()).transaction(ig,"readwrite");await n.objectStore(ig).delete(t),await n.done}async function cg(e,t){const n=Jp(e),i=(await sg()).transaction(ig,"readwrite"),r=i.objectStore(ig),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||Xp(e,o.fid),o}async function ug(e){let t;const n=await cg(e.appConfig,(n=>{const i=function(e){return dg(e||{fid:Qp(),registrationStatus:0})}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Vp.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=Bp(e),r=zp(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={fid:n,authVersion:xp,appId:e.appId,sdkVersion:Mp},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Kp((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:qp(e.authToken)}}throw await $p("Create Installation",c)}(e,t);return og(e.appConfig,n)}catch(n){throw jp(n)&&409===n.customData.serverCode?await ag(e.appConfig):await og(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:hg(e)}:{installationEntry:t}}(e,i);return t=r.registrationPromise,r.installationEntry}));return n.fid===Wp?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function hg(e){let t=await lg(e.appConfig);for(;1===t.registrationStatus;)await Hp(100),t=await lg(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await ug(e);return n||t}return t}function lg(e){return cg(e,(e=>{if(!e)throw Vp.create("installation-not-found");return dg(e)}))}function dg(e){return 1===(t=e).registrationStatus&&t.registrationTime+Lp<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function fg({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${Bp(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){const n=zp(e);return n.append("Authorization",function(e){return`${xp} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const o={installation:{sdkVersion:Mp,appId:e.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Kp((()=>fetch(i,a)));if(c.ok)return qp(await c.json());throw await $p("Generate Auth Token",c)}async function pg(e,t=!1){let n;const i=await cg(e.appConfig,(i=>{if(!mg(i))throw Vp.create("not-registered");const r=i.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Up}(s)))return i;var s;if(1===r.requestStatus)return n=async function(e,t){let n=await gg(e.appConfig);for(;1===n.authToken.requestStatus;)await Hp(100),n=await gg(e.appConfig);const i=n.authToken;return 0===i.requestStatus?pg(e,t):i}(e,t),i;{if(!navigator.onLine)throw Vp.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await fg(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await og(e.appConfig,i),n}catch(n){if(!jp(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await og(e.appConfig,n)}else await ag(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function gg(e){return cg(e,(e=>{if(!mg(e))throw Vp.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+Lp<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function mg(e){return void 0!==e&&2===e.registrationStatus}function yg(e){return Vp.create("missing-app-config-values",{valueName:e})}const vg="installations";ge(new R(vg,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw yg("App Configuration");if(!e.name)throw yg("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw yg(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:me(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ge(new R("installations-internal",(e=>{const t=me(e.getProvider("app").getImmediate(),vg).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await ug(t);return i?i.catch(console.error):pg(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await ug(e);t&&await t}(n),(await pg(n,t)).token}(t,e)}}),"PRIVATE")),Ee(Op,Pp),Ee(Op,Pp,"esm2017");const wg="analytics",Ig="firebase_id",bg="origin",Eg=6e4,Tg="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",_g="https://www.googletagmanager.com/gtag/js",Sg=new q("@firebase/analytics"),Cg=new m("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function kg(e){if(!e.startsWith(_g)){const t=Cg.create("invalid-gtag-resource",{gtagURL:e});return Sg.warn(t.message),""}return e}function Ag(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Ng=30,Dg=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Rg(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Og(e,t=Dg,n){const{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw Cg.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw Cg.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Lg;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Eg),Pg({appId:i,apiKey:r,measurementId:s},o,a,t)}async function Pg(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=Dg){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(n,r);e.addEventListener((()=>{clearTimeout(s),i(Cg.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return Sg.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,r={method:"GET",headers:Rg(i)},s=Tg.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw Cg.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return r.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof g&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(r.deleteThrottleMetadata(o),a)return Sg.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?N(n,r.intervalMillis,Ng):N(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return r.setThrottleMetadata(o,h),Sg.debug(`Calling attemptFetch again in ${u} millis`),Pg(e,h,i,r)}}class Lg{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let Mg,xg;async function Fg(e,t,n,i,r,s,o){var a;const c=Og(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Sg.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>Sg.error(e))),t.push(c);const u=async function(){if(!f())return Sg.warn(Cg.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await p()}catch(e){return Sg.warn(Cg.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,l]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(_g)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:kg}),i=document.createElement("script"),r=`${_g}?l=${e}&id=${t}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),xg&&(r("consent","default",xg),xg=void 0),r("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[bg]="firebase",d.update=!0,null!=l&&(d[Ig]=l),r("config",h.measurementId,d),Mg&&(r("set",Mg),Mg=void 0),h.measurementId}class Ug{constructor(e){this.app=e}_delete(){return delete Vg[this.app.options.appId],Promise.resolve()}}let Vg={},jg=[];const Bg={};let qg,$g,zg="dataLayer",Kg=!1;function Hg(e,t,n){!function(){const e=[];if(d()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Cg.create("invalid-analytics-context",{errorInfo:t});Sg.warn(n.message)}}();const i=e.options.appId;if(!i)throw Cg.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Cg.create("no-api-key");Sg.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Vg[i])throw Cg.create("already-exists",{id:i});if(!Kg){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(zg);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,r){let s=function(...e){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const i=await Ag(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){Sg.error(e)}}(e,t,n,i,r)}else if("config"===r){const[r,o]=s;await async function(e,t,n,i,r,s){const o=i[r];try{if(o)await t[o];else{const e=(await Ag(n)).find((e=>e.measurementId===r));e&&await t[e.appId]}}catch(e){Sg.error(e)}e("config",r,s)}(e,t,n,i,r,o)}else if("consent"===r){const[t]=s;e("consent","update",t)}else if("get"===r){const[t,n,i]=s;e("get",t,n,i)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(e){Sg.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[r]}}(Vg,jg,Bg,zg,"gtag");$g=e,qg=t,Kg=!0}return Vg[i]=Fg(e,jg,Bg,t,qg,zg,n),new Ug(e)}const Gg="@firebase/analytics",Wg="0.10.0";ge(new R(wg,((e,{options:t})=>Hg(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),ge(new R("analytics-internal",(function(e){try{const t=e.getProvider(wg).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=D(e),async function(e,t,n,i,r){if(r&&r.global)e("event",n,i);else{const r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}($g,Vg[e.app.options.appId],t,n,i).catch((e=>Sg.error(e)))}(t,e,n,i)}}catch(e){throw Cg.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Ee(Gg,Wg),Ee(Gg,Wg,"esm2017"),function(e=be()){const t=me(e=D(e),wg);t.isInitialized()?t.getImmediate():function(e,t={}){const n=me(e,wg);if(n.isInitialized()){const e=n.getImmediate();if(v(t,n.getOptions()))return e;throw Cg.create("already-initialized")}n.initialize({options:t})}(e)}(Ie({apiKey:"AIzaSyAzlMJB0WkUFXUXaD-GszRKxJayUo8tZQo",authDomain:"e-medibalance.firebaseapp.com",projectId:"e-medibalance",storageBucket:"e-medibalance.appspot.com",messagingSenderId:"117392039951",appId:"1:117392039951:web:eee754ac35979a36af437a",measurementId:"G-PG5LK8VTP9"}));const Qg=function(e=be()){const t=me(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=me(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(v(n.getOptions(),null!=t?t:{}))return e;Ul(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:up,persistence:[Df,ff,gf]}),i=u("authTokenSyncURL");if(i){const e=(r=i,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>fp)return;const i=null==t?void 0:t.token;pp!==i&&(pp=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){D(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,i,r){D(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var r;const s=a("auth");return s&&function(e,t,n){const i=jd(e);Bl(i._canInitEmulator,i,"emulator-config-failed"),Bl(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=qd(t),{host:o,port:a}=function(e){const t=qd(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:$d(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:$d(t)}}}(t),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}(),Jg=function(e,t){const n=me(be(),"firestore").getImmediate({identifier:"(default)"});if(!n._initialized){const e=(e=>{const t=a("firestore");if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})();e&&function(e,t,n,i={}){var s;const o=(e=Hh(e,Wh))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&os("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=es.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new ds(ls.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new es(o)}e._authCredentials=new ms(new ps(t,n))}}(n,...e)}return n}();document.body.onload=function(){document.getElementById("signOutButton").addEventListener("click",(()=>{(function(e){return D(e).signOut()})(Qg).then((()=>{location.reload()})).catch((e=>{}))}))},Qg.onAuthStateChanged((function(e){if(e)console.log(e),userName.textContent=e.displayName,signOutButton.style.display="block",Ol(wl(Xh(Jg,"admin"),function(e,t,n){const i=ml("where","emel");return Il._create(i,"==",n)}(0,0,e.email))).then((e=>{e.size>0?console.log("User is an admin."):(console.log("User is not an admin."),setTimeout((function(){location.href="./index.html"}),2e3))})).catch((e=>{console.log("Error getting admin collection:",e)}));else{console.log("User is not logged in");let e=document.getElementById("signInRequiredProgressBar"),t=document.getElementById("signInRequiredText");e.style.display="block",t.style.display="block",setTimeout((function(){location.href="./index.html"}),2e3)}})),Ol(wl(Xh(Jg,"pengguna"))).then((e=>{const t=[];var n;e.forEach((e=>{t.push(e)})),n=t,penggunaTable.innerHTML="",n.forEach(((e,t)=>{const n=e.data();console.log(e.data().rekodImbuhan.length);let i="";if(0!=n.rekodImbuhan.length){const e=n.rekodImbuhan.sort(((e,t)=>{const n=new Date(e.tarikhImbuhan);return new Date(t.tarikhImbuhan)-n}));i=e[0].tarikh}else i="Tiada";let r=("bujang"===n.statusPerkahwinan?500:2e3)-e.data().rekodImbuhan.reduce(((e,t)=>e+t.imbuhan),0),s=n.statusPerkahwinan.charAt(0).toUpperCase()+n.statusPerkahwinan.slice(1);!function(e){e.statusPerkahwinan;const t=e.rekodImbuhan.sort(((e,t)=>{const n=new Date(e.tarikhImbuhan);return new Date(t.tarikhImbuhan)-n}));t.reduce(((e,t)=>e+t),0)}(n);const o=document.createElement("tr");o.innerHTML=`\n        <th>${t+1}</th>\n        <td>${n.nama}</td>\n        <td>${n.noGaji}</td>\n        <td>${n.noKadPengenalan}</td>\n        <td>${n.emel}</td>\n        <td>${s}</td>\n        <td>${i}</td>\n        <td>RM ${r.toFixed(2)}</td>\n        <td><a class="button is-link" href="kemaskiniPengguna.html?docid=${e.id}"><span><i class="fa-solid fa-gear"></i></span><span class="ml-1">Kemaskini</span></a></td>\n      `,penggunaTable.appendChild(o)}))})).catch((e=>{console.log("Error getting user data:",e)}))})();